import{L as _,D as E,q as V,o as P,j as G,e as R,a as i,b as q,t as J,d as D,x as W}from"./app-Ck1YkXxy.js";import"./buttons.print-cCKGxkel.js";/* empty css                                                */import"./jspdf.plugin.autotable-B1u0bV-t.js";import{u as C,w as X}from"./xlsx-769MyM77.js";import{_ as K}from"./RHLayout-CTxN5zrK.js";const Q={class:"mt-0 bg-white p-4 shadow rounded-lg h-5/6"},Y=i("h2",{class:"font-bold text-center text-xl pt-0"}," Formar Unidades",-1),Z=i("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-1.5"},null,-1),tt={class:"overflow-x-auto"},et={class:"text-sm leading-normal border-b border-gray-300"},rt=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),at={class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"2"},dt=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),ot=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),it=i("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300 text-left",colspan:"3"},"ENTRADA",-1),nt=i("th",{class:"py-2 px-4 bg-red-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"CORTE",-1),st=i("th",{class:"py-2 px-4 bg-blue-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"ÚLTIMAS CORRIDAS",-1),ct=i("th",{class:"py-2 px-4 bg-yellow-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"4"},"CASTIGO",-1),lt=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),pt=i("tr",{class:"text-sm leading-normal border-b border-gray-300"},[i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," ID "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Ruta "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Trab. DOMINGO "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Unidad "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Socio / Prestador "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. entrada "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo entrada "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Extremo "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Corte "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Causa "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo de Corrida "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. finaliza "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Motivo "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Otras observaciones "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Operador ")],-1),ht={__name:"FormarUnidades",props:{message:{String,default:""},color:{String,default:""},ruta:{type:Object},unidad:{type:Object},unidadesConOperador:{type:Object},operador:{type:Object},directivo:{type:Object},rolServicio:{type:Object},castigo:{type:Object},entrada:{type:Object},corte:{type:Object},ultimaCorrida:{type:Object},tipoUltimaCorrida:{type:Object},usuario:{type:Object}},setup(v){_.use(E),_.use(E);const d=v,b=new Date().toLocaleDateString(),T=I(new Date().getDay());function I(o){return["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][o]}V(()=>d.entrada.filter(o=>new Date(o.fechaRegistro).toLocaleDateString()===b));const F=()=>{W(()=>{const c=$("#formacionTablaId").DataTable().rows({search:"applied",page:"current"}).data();if(!c.length){console.warn("No hay datos para exportar.");return}const l=new Date().toISOString().split("T")[0],p=Object.fromEntries(d.ruta.map(a=>[a.idRuta,a.nombreRuta])),r=Object.fromEntries(d.rolServicio.map(a=>[a.idUnidad,a.trabajaDomingo])),t=Object.fromEntries(d.unidad.map(a=>[a.idUnidad,a.numeroUnidad])),e=Object.fromEntries(d.directivo.map(a=>[a.idDirectivo,a.nombre_completo])),s=Object.fromEntries(d.entrada.map(a=>[a.idUnidad,{horaEntrada:a.horaEntrada,tipoEntrada:a.tipoEntrada,extremo:a.extremo,created_at:a.created_at}]));Object.fromEntries(d.corte.map(a=>[a.idUnidad,[]]));const g=Object.fromEntries(d.ultimaCorrida.map(a=>[a.idUnidad,{tipoCorrida:a.idTipoUltimaCorrida,horaInicioUC:a.horaInicioUC,horaFinUC:a.horaFinUC,created_at:a.created_at}]));Object.fromEntries(d.castigo.map(a=>[a.idUnidad,[]]));const f=Object.fromEntries(d.operador.map(a=>[a.idOperador,a.nombre_completo])),S=Object.fromEntries(d.tipoUltimaCorrida.map(a=>[a.idTipoUltimaCorrida,a.tipoUltimaCorrida])),m=a=>{if(!a)return"";const[n,y]=a.split(":");return`${n}:${y}`},k=c.toArray().reduce((a,n)=>{var j,H;const y=s[n.idUnidad]||{},B=d.corte.filter(u=>u.idUnidad===n.idUnidad&&u.created_at.split("T")[0]===l),h=g[n.idUnidad]||{},w=d.castigo.filter(u=>u.idUnidad===n.idUnidad&&u.created_at.split("T")[0]===l);r[n.idUnidad];const x=((j=y.created_at)==null?void 0:j.split("T")[0])===l,U=((H=h.created_at)==null?void 0:H.split("T")[0])===l;return w.length>0,a[n.idUnidad]||(a[n.idUnidad]={ID:n.idUnidad,Ruta:p[n.idRuta]||"N/A","Trab. Domingo":r[n.idUnidad]||"Sin Asignar",Unidad:t[n.idUnidad]||"","Socio/Prestador":e[n.idDirectivo]||"","Hr. Entrada":x&&m(y.horaEntrada)||"","Tipo Entrada":x&&y.tipoEntrada||"",Extremo:x&&y.extremo||"","Hr. Corte":"",Causa:"","Hr. Regreso":"","Tipo De Corrida":U&&S[h.tipoCorrida]||"","Hr. Inicio UC":U&&m(h.horaInicioUC)||"","Hr. Regreso UC":U&&m(h.horaFinUC)||"","Hr. Inicio":"","Hr. Finaliza":"",Motivo:"","Otras Observaciones":"",Operador:f[n.idOperador]||"Sin Asignar"}),B.forEach(u=>{a[n.idUnidad]["Hr. Corte"]+=(a[n.idUnidad]["Hr. Corte"]?", ":"")+m(u.horaCorte),a[n.idUnidad].Causa+=(a[n.idUnidad].Causa?", ":"")+u.causa,a[n.idUnidad]["Hr. Regreso"]+=(a[n.idUnidad]["Hr. Regreso"]?", ":"")+m(u.horaRegreso)}),w.forEach(u=>{a[n.idUnidad]["Hr. Inicio"]+=(a[n.idUnidad]["Hr. Inicio"]?", ":"")+m(u.horaInicio),a[n.idUnidad]["Hr. Finaliza"]+=(a[n.idUnidad]["Hr. Finaliza"]?", ":"")+m(u.horaFin),a[n.idUnidad].Motivo+=(a[n.idUnidad].Motivo?", ":"")+u.castigo,a[n.idUnidad]["Otras Observaciones"]+=(a[n.idUnidad]["Otras Observaciones"]?", ":"")+u.observaciones}),a},{}),A=Object.values(k),N=C.json_to_sheet(A),O=C.book_new();C.book_append_sheet(O,N,"Formación De Unidades");const z=new Date().toISOString().split("T")[0];X(O,`Formación_De_Unidades_${z}.xlsx`)})},M=[{extend:"copyHtml5",text:'<i class="fa-solid fa-copy"></i> Copiar',className:"bg-cyan-500 hover:bg-cyan-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,2]},button:!0},{title:"Formación De Unidades",text:'<i class="fa-solid fa-file-excel"></i> Excel',className:"bg-green-600 hover:bg-green-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",action:()=>F()},{title:"Formación De Unidades",extend:"print",text:'<i class="fa-solid fa-print"></i> Imprimir',className:"bg-blue-500 hover:bg-blue-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}}],L=[{data:null,render:function(o,c,l,p){return p.row+1}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.ruta.find(e=>e.idRuta===r.idRuta);return t?t.nombreRuta:""}else return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.rolServicio.filter(e=>e.idUnidad===r.idUnidad);return t.length>0?(t.sort((e,s)=>new Date(s.created_at)-new Date(e.created_at)),t[0].trabajaDomingo):'<span style="color: red;">Sin asignar</span>'}else return"Unidad no encontrada"}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);return r?r.numeroUnidad:""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.directivo.find(e=>e.idDirectivo===r.idDirectivo);return t?t.nombre_completo:""}else return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.entrada.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map(s=>s.horaEntrada.substring(0,5)).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.entrada.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map(s=>s.tipoEntrada).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.entrada.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map(s=>s.extremo).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.corte.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map((s,g)=>`
            <div style="${t.length>1&&g!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${s.horaCorte.substring(0,5)}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.corte.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map((s,g)=>`
            <div style="${t.length>1&&g!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${s.causa}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.corte.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0)return t.map((s,g)=>{const f=s.horaRegreso?s.horaRegreso.substring(0,5):"";return`
            <div style="${t.length>1&&g!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${f}</div>
            </div>
          `}).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.ultimaCorrida.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0){const e=d.tipoUltimaCorrida.find(s=>s.idTipoUltimaCorrida===t[0].idTipoUltimaCorrida);if(e)return e.tipoUltimaCorrida}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.ultimaCorrida.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0){const e=t[0].horaInicioUC;return e?e.substring(0,5):""}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.ultimaCorrida.filter(e=>e.idUnidad===r.idUnidad&&new Date(e.created_at).toLocaleDateString()===b);if(t.length>0){const e=t[0].horaFinUC;if(e)return e.substring(0,5)}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(t=>t.idUnidad===o&&new Date(t.created_at).toLocaleDateString()===b);if(r.length>0){const t=r.map(e=>({horaInicio:e.horaInicio?e.horaInicio.substring(0,5):""}));return t.map((e,s)=>`
          <div style="${t.length>1&&s!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${e.horaInicio}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(t=>t.idUnidad===o&&new Date(t.created_at).toLocaleDateString()===b);if(r.length>0){const t=r.map(e=>({horaFin:e.horaFin?e.horaFin.substring(0,5):""}));return t.map((e,s)=>`
          <div style="${t.length>1&&s!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${e.horaFin}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(t=>t.idUnidad===o&&new Date(t.created_at).toLocaleDateString()===b);if(r.length>0){const t=r.map(e=>e.castigo||"");return t.map((e,s)=>`<div style="${t.length>1&&s!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${e}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(t=>t.idUnidad===o&&new Date(t.created_at).toLocaleDateString()===b);if(r.length>0){const t=r.map(e=>e.observaciones||"");return t.map((e,s)=>`<div style="${t.length>1&&s!==t.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${e}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(t=>t.idUnidad===o);if(r){const t=d.operador.find(e=>e.idOperador===r.idOperador);return t?t.nombre_completo:'<span style="color: red;">Sin asignar</span>'}else return""}}];return(o,c)=>(P(),G(K,{title:"Formar Unidades",usuario:d.usuario},{default:R(()=>[i("div",Q,[Y,Z,i("div",tt,[q(D(_),{class:"w-full table-auto text-sm display nowrap stripe compact cell-border order-column",id:"formacionTablaId",name:"formacionTablaId",columns:L,data:v.unidad,options:{responsive:!1,autoWidth:!1,dom:"Bftrip",language:{search:"Buscar",zeroRecords:"No hay registros para mostrar",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)"},buttons:[M],paging:!1,lengthMenu:[]}},{default:R(()=>[i("thead",null,[i("tr",et,[rt,i("th",at,"FECHA: "+J(D(T)+", "+D(b)),1),dt,ot,it,nt,st,ct,lt]),pt])]),_:1},8,["data","options"])])])]),_:1},8,["usuario"]))}};export{ht as default};
