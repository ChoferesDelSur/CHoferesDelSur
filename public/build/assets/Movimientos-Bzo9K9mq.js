import{u as P,r as y,q as $,i as H,o as u,j as U,e as I,a as e,g as R,t as x,w as M,d as v,k as N,c as f,l as w,F as S,m as E,p as O,f as h,L as A,D as L,s as W,b as C}from"./app-B24ETZKA.js";import"./buttons.print-HLyAFXod.js";import{S as F}from"./sweetalert2.all-DKy2ZldH.js";import{_ as V}from"./Mensaje-DNLeBPvy.js";import{_ as q}from"./RHLayout-B597AyYb.js";import{_ as G}from"./Modal-Dysy_OQF.js";/* empty css                                                */import"./jspdf.plugin.autotable-nMR_JYMt.js";const X={class:"mt-2 bg-white p-4 shadow rounded-lg"},J={class:"border-b border-gray-900/10 pb-12"},K={class:"text-base font-semibold leading-7 text-gray-900"},Q=e("p",{class:"mt-1 text-sm leading-6 text-gray-600 mb-4"},[h("Rellene el formulario para poder registrar un nuevo movimiento. Los campos con "),e("span",{class:"text-red-500"},"*"),h(" son obligatorios. ")],-1),Y={class:"flex flex-wrap -mx-4"},Z={class:"sm:col-span-2"},ee={class:"sm:col-span-1",hidden:""},oe=e("label",{for:"idMovimiento",class:"block text-sm font-medium leading-6 text-gray-900"},"idMovimiento",-1),te={class:"mt-2"},ie=["id"],se={class:"sm:col-span-2 px-4"},ae=e("label",{for:"fechaMovimiento",class:"block text-sm font-medium leading-6 text-gray-900"},[h("Fecha de Movimiento "),e("span",{class:"text-red-500"},"*")],-1),re={class:"mt-2"},ne=["id"],de={key:0,class:"text-red-500 text-xs mt-1"},le={class:"sm:col-span-2 px-4"},ce=e("label",{for:"estado",class:"block text-sm font-medium leading-6 text-gray-900"},[h("Movimiento a realizar "),e("span",{class:"text-red-500"},"*")],-1),me={class:"mt-2"},pe=["id"],ue=e("option",{value:"",disabled:"",selected:""},"Seleccione el tipo de movimiento",-1),ve=["value"],ge={key:0,class:"text-red-500 text-xs mt-1"},fe={class:"sm:col-span-2 px-4"},be=e("label",{for:"operador",class:"block text-sm font-medium leading-6 text-gray-900"},[h("Operador "),e("span",{class:"text-red-500"},"*")],-1),he={class:"mt-2"},xe=["id"],ye=e("option",{value:"",disabled:"",selected:""},"Seleccione al operador",-1),_e=["value"],Me={key:0,class:"text-red-500 text-xs mt-1"},we={class:"sm:col-span-2 px-4"},ke=e("label",{for:"directivo",class:"block text-sm font-medium leading-6 text-gray-900"},[h("Socio / Prestador "),e("span",{class:"text-red-500"},"*")],-1),Se={class:"mt-2"},Ee=["id"],Oe=e("option",{value:"",disabled:"",selected:""},"Seleccione al Socio/Prestador",-1),je=["value"],Be={key:0,class:"text-red-500 text-xs mt-1"},De={class:"sm:col-span-2 px-4"},Te=e("label",{for:"tipoMovimiento",class:"block text-sm font-medium leading-6 text-gray-900"},[h("Tipo de Movimiento "),e("span",{class:"text-red-500"},"*")],-1),$e={class:"mt-2"},Ae=["id"],Ce=e("option",{value:"",disabled:"",selected:""},"Seleccione el tipo de movimiento",-1),Fe=["value"],Ie={key:0,class:"text-red-500 text-xs mt-1"},Ne={class:"mt-6 flex items-center justify-end gap-x-6"},Le=["id"],Pe=e("i",{class:"fa-solid fa-ban"},null,-1),Ue=["disabled"],ze=e("i",{class:"fa-solid fa-floppy-disk mr-2"},null,-1),He={__name:"FormularioMovimiento",props:{show:{type:Boolean,default:!1,hora:String},maxWidth:{type:String,default:"2xl"},closeable:{type:Boolean,default:!0},directivo:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},operadoresAlta:{type:Object,default:()=>({})},operadoresBaja:{type:Object,default:()=>({})},estado:{type:Object,default:()=>({})},movimiento:{type:Object,default:()=>({})},tipoMovimiento:{type:Object,default:()=>({})},title:{type:String},modal:{type:String},op:{type:String}},emits:["close"],setup(p,{emit:m}){const g=p,j=m,t=P({idMovimiento:g.movimiento.idMovimiento,fechaMovimiento:g.movimiento.fechaMovimiento,estado:g.movimiento.idEstado,operador:g.movimiento.idOperador,directivo:g.movimiento.idDirectivo,tipoMovimiento:g.movimiento.idTipoMovimiento}),b=y(g.estado.filter(s=>s.idEstado===1||s.idEstado===2)),B=$(()=>t.estado?g.tipoMovimiento.filter(s=>s.idEstado===t.estado):[]),k=$(()=>{let s=[];return t.estado===1?s=g.operadoresBaja:t.estado===2&&(s=g.operadoresAlta),s.sort((c,o)=>c.nombre_completo.localeCompare(o.nombre_completo))}),D=$(()=>g.directivo.sort((s,c)=>s.nombre_completo.localeCompare(c.nombre_completo))),_=y(""),i=y(""),a=y(""),r=y(""),d=y("");H(()=>t.operador,s=>{const c=k.value.find(o=>o.idOperador===s);c&&(t.directivo=c.idDirectivo)});const n=async()=>{j("close"),t.reset()},l=s=>s!=null,T=s=>!(s==null||((typeof s=="string"||s instanceof String)&&(s=new Date(s)),!(s instanceof Date))||isNaN(s.getTime())),z=async()=>{_.value=T(t.fechaMovimiento)?"":"Fecha de movimiento no válido",i.value=l(t.estado)?"":"Seleccione el movimiento a realizar",a.value=l(t.operador)?"":"Seleccione al operador",r.value=l(t.directivo)?"":"Seleccione al directivo",d.value=l(t.tipoMovimiento)?"":"Seleccione el tipo de movimiento",!(_.value||i.value||a.value||r.value||d.value)&&t.post(route("rh.addMovimiento"),{onSuccess:()=>{n(),_.value="",i.value="",a.value="",r.value="",d.value=""}})};return(s,c)=>(u(),U(G,{show:p.show,"max-width":p.maxWidth,closeable:p.closeable,onClose:n},{default:I(()=>[e("div",X,[e("form",{onSubmit:R(z,["prevent"])},[e("div",J,[e("h2",K,x(p.title),1),Q,e("div",Y,[e("div",Z,[e("div",ee,[oe,e("div",te,[M(e("input",{type:"number",name:"idMovmiento","onUpdate:modelValue":c[0]||(c[0]=o=>v(t).idMovimiento=o),placeholder:"Ingrese id del movimiento",id:"idMovimiento"+p.op,class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,8,ie),[[N,v(t).idMovimiento]])])])]),e("div",se,[ae,e("div",re,[M(e("input",{type:"date",name:"fechaMovimiento",id:"fechaMovimiento"+p.op,"onUpdate:modelValue":c[1]||(c[1]=o=>v(t).fechaMovimiento=o),placeholder:"Ingrese la fecha de movimiento",class:"block w-44 rounded-md border-0 px-1.5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,8,ne),[[N,v(t).fechaMovimiento]])]),_.value!=""?(u(),f("div",de,x(_.value),1)):w("",!0)]),e("div",le,[ce,e("div",me,[M(e("select",{name:"tipoDirectivo",id:"tipoDirectivo"+p.op,"onUpdate:modelValue":c[2]||(c[2]=o=>v(t).estado=o),placeholder:"Seleccione el tipo de directivo",class:"block rounded-md border-0 px-1.5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[ue,(u(!0),f(S,null,E(b.value,o=>(u(),f("option",{key:o.idEstado,value:o.idEstado},x(o.estado),9,ve))),128))],8,pe),[[O,v(t).estado]])]),i.value!=""?(u(),f("div",ge,x(i.value),1)):w("",!0)]),e("div",fe,[be,e("div",he,[M(e("select",{name:"operador",id:"operador"+p.op,"onUpdate:modelValue":c[3]||(c[3]=o=>v(t).operador=o),placeholder:"Seleccione al operador",class:"block w-54 rounded-md border-0 px-1.5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[ye,(u(!0),f(S,null,E(k.value,o=>(u(),f("option",{key:o.idOperador,value:o.idOperador},x(o.nombre_completo),9,_e))),128))],8,xe),[[O,v(t).operador]])]),a.value!=""?(u(),f("div",Me,x(a.value),1)):w("",!0)]),e("div",we,[ke,e("div",Se,[M(e("select",{name:"directivo",id:"directivo"+p.op,"onUpdate:modelValue":c[4]||(c[4]=o=>v(t).directivo=o),placeholder:"Seleccione al Socio/Prestador",class:"block rounded-md border-0 px-1.5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[Oe,(u(!0),f(S,null,E(D.value,o=>(u(),f("option",{key:o.idDirectivo,value:o.idDirectivo},x(o.nombre_completo),9,je))),128))],8,Ee),[[O,v(t).directivo]])]),r.value!=""?(u(),f("div",Be,x(r.value),1)):w("",!0)]),e("div",De,[Te,e("div",$e,[M(e("select",{name:"tipoMovimiento",id:"tipoMovimiento"+p.op,"onUpdate:modelValue":c[5]||(c[5]=o=>v(t).tipoMovimiento=o),placeholder:"Seleccione el tipo de movimiento",class:"block rounded-md border-0 px-1.5 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[Ce,(u(!0),f(S,null,E(B.value,o=>(u(),f("option",{key:o.idTipoMovimiento,value:o.idTipoMovimiento},x(o.tipoMovimiento),9,Fe))),128))],8,Ae),[[O,v(t).tipoMovimiento]])]),d.value!=""?(u(),f("div",Ie,x(d.value),1)):w("",!0)])])]),e("div",Ne,[e("button",{type:"button",id:"cerrar"+p.op,class:"text-sm font-semibold leading-6 bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 text-white py-2 px-4 rounded","data-bs.dismiss":"modal",onClick:n},[Pe,h(" Cancelar")],8,Le),e("button",{type:"submit",class:"bg-green-500 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded",disabled:v(t).processing},[ze,h("Guardar")],8,Ue)])],32)])]),_:1},8,["show","max-width","closeable"]))}},Re={class:"mt-0 bg-white p-4 shadow rounded-lg h-5/6"},We=e("h2",{class:"font-bold text-center text-xl pt-0"},"Movimientos",-1),Ve=e("div",{class:"my-1"},null,-1),qe=e("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-3"},null,-1),Ge={class:"py-3 flex flex-col md:flex-row md:items-start md:space-x-3 space-y-3 md:space-y-0"},Xe=e("i",{class:"fa fa-plus mr-2"},null,-1),Je=e("i",{class:"fa fa-trash mr-2"},null,-1),Ke={class:"overflow-x-auto"},Qe=e("thead",null,[e("tr",{class:"text-sm leading-normal"},[e("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}),e("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," ID "),e("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," Fecha de Movimiento "),e("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," Movimiento "),e("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," Operador "),e("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," Socio / Prestador "),e("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-light border-b border-grey-light"}," Tipo de Movimiento ")])],-1),Ye="xl",Ze=!0,lo={__name:"Movimientos",props:{message:{String,default:""},color:{String,default:""},operador:{type:Object},operadoresAlta:{type:Object},operadoresBaja:{type:Object},estado:{type:Object},directivo:{type:Object},movimiento:{type:Object},usuario:{type:Object},tipoMovimiento:{type:Object}},setup(p){A.use(L),A.use(L);const m=p,g=[{extend:"copyHtml5",text:'<i class="fa-solid fa-copy"></i> Copiar',className:"bg-cyan-500 hover:bg-cyan-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,2,3,4,5,6]},button:!0},{title:"Movimientos registrados",extend:"excelHtml5",text:'<i class="fa-solid fa-file-excel"></i> Excel',className:"bg-green-600 hover:bg-green-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[2,3,4,5,6,7,8]}},{title:"Movimientos registrados",extend:"pdfHtml5",text:'<i class="fa-solid fa-file-pdf"></i> PDF',className:"bg-red-500 hover:bg-red-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",orientation:"landscape",exportOptions:{columns:[2,3,4,5,6,7,8]}},{title:"Operadores registrados",extend:"print",text:'<i class="fa-solid fa-print"></i> Imprimir',className:"bg-blue-500 hover:bg-blue-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[1,2,3,4,5,6]}}],j=[{data:null,render:function(i,a,r,d){return`<input type="checkbox" class="movimiento-checkboxes" data-id="${r.idMovimiento}" ">`}},{data:null,render:function(i,a,r,d){return d.row+1}},{data:"fechaMovimiento"},{data:"idEstado",render:function(i,a,r,d){const n=m.estado.find(l=>l.idEstado===i);return n?n.estado:""}},{data:"idOperador",render:function(i,a,r,d){const n=m.operador.find(l=>l.idOperador===i);return n?n.nombre_completo:""}},{data:"idDirectivo",render:function(i,a,r,d){const n=m.directivo.find(l=>l.idDirectivo===i);return n?n.nombre_completo:""}},{data:"idTipoMovimiento",render:function(i,a,r,d){const n=m.tipoMovimiento.find(l=>l.idTipoMovimiento===i);return n?n.tipoMovimiento:""}}],t=y(!1);y(!1);const b=y([]),B=P({_method:"DELETE"}),k=()=>{t.value=!1},D=i=>{b.value.includes(i)?b.value=b.value.filter(r=>r!==i):b.value.push(i);const a=document.getElementById("eliminarABtn");b.value.length>0?a.removeAttribute("disabled"):a.setAttribute("disabled","")};W(()=>{document.getElementById("movimientosTablaId").addEventListener("click",i=>{const a=i.target;if(a.classList.contains("movimiento-checkboxes")){const r=parseInt(a.getAttribute("data-id"));if(m.movimiento){const d=m.movimiento.find(n=>n.idMovimiento===r);d?D(d):console.log("No se tiene movimiento")}}})});const _=()=>{const i=F.mixin({buttonsStyling:!0}),a=b.value.map(r=>{const d=m.operador.find(l=>l.idOperador===r.idOperador),n=m.estado.find(l=>l.idEstado===r.idEstado);return`${d?d.nombre_completo:"Desconocido"} ~ ${n?n.estado:"Desconocido"}`}).join("<br>");i.fire({title:"¿Estas seguro que deseas eliminar el movimiento seleccionado?",html:`Movimiento seleccionado:<br>${a}`,icon:"warning",showCancelButton:!0,confirmButtonText:'<i class="fa-solid fa-check"></i> Confirmar',cancelButtonText:'<i class="fa-solid fa-ban"></i> Cancelar'}).then(async r=>{if(r.isConfirmed)try{const n=b.value.map(T=>T.idMovimiento).join(",");await B.post(route("rh.eliminarMovimiento",n)),b.value=[];const l=document.getElementById("eliminarABtn");b.value.length>0?l.removeAttribute("disabled"):l.setAttribute("disabled",""),F.fire({title:"Movimiento(s) eliminado(s) correctamente",icon:"success"}),window.flash={message:"Movimiento(s) eliminado(s) correctamente",color:"green"}}catch(d){console.log("Error al eliminar varios movimientos: "+d),F.fire({title:"Error",text:"Hubo un error al eliminar el movimiento. Por favor, inténtalo de nuevo más tarde.",icon:"error"})}})};return(i,a)=>(u(),U(q,{title:"Movimientos",usuario:m.usuario},{default:I(()=>[e("div",Re,[We,Ve,qe,C(V),e("div",Ge,[e("button",{class:"bg-green-500 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded",onClick:a[0]||(a[0]=r=>t.value=!0),"data-bs-toggle":"modal","data-bs-target":"#modalCreate"},[Xe,h("Realizar Movimiento ")]),e("button",{id:"eliminarABtn",disabled:"",class:"bg-red-500 hover:bg-red-500 text-white font-semibold py-2 px-4 rounded",onClick:_},[Je,h(" Eliminar Movimiento ")])]),e("div",Ke,[C(v(A),{class:"w-full table-auto text-sm display nowrap stripe compact cell-border order-column",id:"movimientosTablaId",name:"movimientosTablaId",columns:j,data:p.movimiento,options:{responsive:!1,autoWidth:!1,dom:"Bftrip",language:{search:"Buscar",zeroRecords:"No hay registros para mostrar",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)"},buttons:[g],paging:!1}},{default:I(()=>[Qe]),_:1},8,["data","options"])])]),C(He,{show:t.value,"max-width":Ye,closeable:Ze,onClose:k,title:"Añadir Movimento",modal:"modalCreate",operador:m.operador,estado:m.estado,directivo:m.directivo,movimiento:m.movimiento,tipoMovimiento:m.tipoMovimiento,operadoresAlta:m.operadoresAlta,operadoresBaja:m.operadoresBaja},null,8,["show","operador","estado","directivo","movimiento","tipoMovimiento","operadoresAlta","operadoresBaja"])]),_:1},8,["usuario"]))}};export{lo as default};
