import{S as V}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{E as se}from"./jspdf.plugin.autotable-CHB54n7J.js";/* empty css                                                               */import{r as L,J as I,o as l,h as d,y as x,b as a,t as h,j as N,z as O,F as y,u as m,K as z,i as W,n as X,k as ne,G as re,a as le,w as de,d as ce}from"./app-aOsGy6te.js";import{u as B,w as me}from"./xlsx-DjuO7_Ju.js";import{_ as ue}from"./RHLayout-vdgIbD2T.js";const pe={class:"text-lg font-bold"},ve={class:"flex flex-wrap gap-4 mb-3"},fe=["value"],ge={class:"flex flex-wrap gap-4 mb-3"},be={class:"flex flex-wrap space-x-3 mb-2"},xe=["onUpdate:modelValue"],he=["value"],ye=["value"],_e=["value"],Me=["value"],Ae={class:"flex flex-wrap space-x-3"},we=["onClick"],q=2024,ke={__name:"ReportesMovimientos",props:{message:{String,default:""},color:{String,default:""},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},directivo:{type:Object,default:()=>({})},movimiento:{type:Object,default:()=>({})},tipoMovimiento:{type:Object,default:()=>({})}},setup(C){const c=L([]),R=I({directivo:null,movimiento:null}),_=async(i,e)=>{let o="",t=e.valor.value?e.valor.value:e.valor,n=t;if(e.tipo==="dia"&&t.includes("/")){const[u,D,S]=t.split("/");n=`${u}-${D}-${S}`}e.tipo==="semana"?o=route("reportes.MovSemana",{idDirectivo:i,semana:t}):e.tipo==="mes"||typeof e=="number"?o=route("reportes.MovMes",{idDirectivo:i,mes:t}):e.tipo==="anio"?o=route("reportes.MovAnio",{idDirectivo:i,anio:t}):e.tipo==="dia"&&(o=route("reportes.MovDia",{idDirectivo:i,dia:n}));try{const u=await re.get(o);c.value=u.data}catch{V.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},H=async(i,e,o,t)=>{if(!o||!t.tipo||!t.valor){V.fire({title:"Error",text:"Por favor seleccione los parámetros para poder generar el archivo.",icon:"error",confirmButtonText:"OK"});return}let n={tipo:i.periodoSeleccionado,valor:""};i.periodoSeleccionado==="semana"?n.valor=A:i.periodoSeleccionado==="mes"?n.valor=w:i.periodoSeleccionado==="anio"?n.valor=k:i.periodoSeleccionado==="dia"&&(n.valor=M);try{await _(o,n),i.titulo==="Movimientos"?e==="pdf"?Q(i.titulo,n):e==="excel"?Z(i.titulo,n):e==="imprimir"&&imprimirReporte(i.titulo,n):V.fire({title:`Generar el reporte "${i.titulo}" en ${e}`,text:"Lógica para generar este tipo de reporte aquí",icon:"info",confirmButtonText:"OK"})}catch(u){console.error("Error al obtener datos:",u),V.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},Q=(i,e)=>{const o=new se({orientation:"landscape"});let t;e.tipo==="semana"?t=`Semana ${e.valor}`:e.tipo==="mes"?t=P[e.valor-1]:e.tipo==="anio"?t=e.valor:e.tipo==="dia"?t=typeof e.valor=="string"?e.valor:e.valor._value||"Fecha inválida":t=e.valor,o.setFontSize(12),o.text(`Reporte de ${i} - Período: ${t}`,14,20);const n=c.value.filter(r=>r.estado.idEstado===1),u=c.value.filter(r=>r.estado.idEstado===2);o.setFontSize(12),o.text("Movimientos de Alta",14,30);const D=["Fecha","Movimiento","Operador","Socio/Prestador","Tipo De Movimiento"],S=n.map(r=>{var T,$;const b=r.fechaMovimiento||"N/A",v=r.estado?r.estado.estado:"N/A",f=r.operador?`${r.operador.nombre_completo}`:"N/A",K=((T=r.directivo)==null?void 0:T.nombre_completo)||"N/A",G=(($=r.tipo_movimiento)==null?void 0:$.tipoMovimiento)||"N/A";return[b,v,f,K,G]});o.autoTable({head:[D],body:S,startY:34,margin:{top:30}}),o.setFontSize(12),o.text("Movimientos de Baja",14,o.autoTable.previous.finalY+10);const j=["Fecha","Movimiento","Operador","Socio/Prestador","Tipo De Movimiento"],Y=u.map(r=>{var T,$;const b=r.fechaMovimiento||"N/A",v=r.estado?r.estado.estado:"N/A",f=r.operador?`${r.operador.nombre_completo}`:"N/A",K=((T=r.directivo)==null?void 0:T.nombre_completo)||"N/A",G=(($=r.tipo_movimiento)==null?void 0:$.tipoMovimiento)||"N/A";return[b,v,f,K,G]});o.autoTable({head:[j],body:Y,startY:o.autoTable.previous.finalY+14,margin:{top:30}});const p=o.autoTable.previous.finalY+25,s=14,g=150;o.setFontSize(12),o.text("Elaboró:",s,p),o.line(s+20,p+2,s+130,p+2),o.text("Recibió:",g,p),o.line(g+20,p+2,g+100,p+2),o.text("Jefa de Departamento de Recursos Humanos",s+30,p+10),o.text("Departamento de Servicio",g+30,p+10);const F=new Date().toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"});o.setFontSize(10),o.text(`Fecha de creación: ${F}`,14,o.internal.pageSize.height-10);const E=`${i}-${t}.pdf`;o.save(E)},Z=(i,e)=>{let o;e.tipo==="semana"?o=`Semana ${e.valor}`:e.tipo==="mes"?o=P[e.valor-1]:e.tipo==="anio"?o=e.valor:e.tipo==="dia"?o=typeof e.valor=="string"?e.valor:e.valor._value||"Fecha inválida":o=e.valor;const t=`${i}-${o}.xlsx`,n=c.value.filter(s=>s.estado.idEstado===1),u=c.value.filter(s=>s.estado.idEstado===2),D=[["Fecha","Movimiento","Operador","Directivo","Tipo De Movimiento"]];n.forEach(s=>{var v,f;const g=s.fechaMovimiento||"N/A",F=s.estado?s.estado.estado:"N/A",E=s.operador?`${s.operador.nombre_completo}`:"N/A",r=((v=s.directivo)==null?void 0:v.nombre_completo)||"N/A",b=((f=s.tipo_movimiento)==null?void 0:f.tipoMovimiento)||"N/A";D.push([g,F,E,r,b])});const S=[["Fecha","Movimiento","Operador","Directivo","Tipo De Movimiento"]];u.forEach(s=>{var v,f;const g=s.fechaMovimiento||"N/A",F=s.estado?s.estado.estado:"N/A",E=s.operador?`${s.operador.nombre_completo}`:"N/A",r=((v=s.directivo)==null?void 0:v.nombre_completo)||"N/A",b=((f=s.tipo_movimiento)==null?void 0:f.tipoMovimiento)||"N/A";S.push([g,F,E,r,b])});const j=B.book_new(),Y=B.aoa_to_sheet(D),p=B.aoa_to_sheet(S);B.book_append_sheet(j,Y,"Movimientos de Alta"),B.book_append_sheet(j,p,"Movimientos de Baja"),me(j,t)},ee=[{titulo:"Movimientos",periodo:"dia",periodoSeleccionado:"dia"}],oe=[{tipo:"pdf",texto:"Generar PDF",clase:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-pdf"},{tipo:"excel",texto:"Generar Excel",clase:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-excel"}],te=Array.from({length:52},(i,e)=>e+1),P=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],J=new Date().getFullYear(),ie=Array.from({length:J-q+1},(i,e)=>q+e);let U=i=>{const e={day:"2-digit",month:"2-digit",year:"numeric"};return new Intl.DateTimeFormat("es-ES",e).format(i)},M=L(U(new Date)),A=1,w=1,k=J;Array.from({length:7},(i,e)=>{const o=new Date,t=o.getDay()||7;return o.setDate(o.getDate()-t+1+e),U(o)});const ae=Array.from({length:7},(i,e)=>{const o=new Date,t=o.getDay()||7;return o.setDate(o.getDate()-t+1+e),U(o)});return I({periodoSeleccionado:"",semana:null,mes:null,anio:null,dia:null}),(i,e)=>(l(),d(y,null,x(ee,o=>a("div",{key:o.titulo,class:"mb-4 bg-zinc-100 rounded-lg p-4"},[a("h3",pe,h(o.titulo),1),e[10]||(e[10]=a("div",{class:"bg-gradient-to-r from-cyan-500 to-cyan-500 h-px mb-2"},null,-1)),a("div",ve,[e[7]||(e[7]=a("h2",{class:"font-semibold text-l pt-0"},"Buscar por: ",-1)),a("div",null,[a("div",null,[N(a("select",{name:"directivo",id:"directivo","onUpdate:modelValue":e[0]||(e[0]=t=>R.directivo=t),class:"block w-72 rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[e[5]||(e[5]=a("option",{disabled:"",select:"",value:""},"--------------- Socio/Prestador --------------- ",-1)),e[6]||(e[6]=a("option",{value:"todas"},"Todos los socios y prestadores",-1)),(l(!0),d(y,null,x(C.directivo,t=>(l(),d("option",{key:t.idDirectivo,value:t.idDirectivo},h(t.nombre_completo),9,fe))),128))],512),[[O,R.directivo]])])])]),a("div",ge,[a("div",be,[e[9]||(e[9]=a("h2",{class:"font-semibold text-l pt-0"},"Periodo: ",-1)),N(a("select",{"onUpdate:modelValue":t=>o.periodoSeleccionado=t,class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},e[8]||(e[8]=[a("option",{value:"dia"},"Día",-1),a("option",{value:"semana"},"Semanal",-1),a("option",{value:"mes"},"Mensual",-1),a("option",{value:"anio"},"Anual",-1)]),8,xe),[[O,o.periodoSeleccionado]]),o.periodoSeleccionado==="dia"?N((l(),d("select",{key:0,"onUpdate:modelValue":e[1]||(e[1]=t=>z(M)?M.value=t:M=t),class:"block w-28 rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(l(!0),d(y,null,x(m(ae),(t,n)=>(l(),d("option",{key:n,value:t},h(t),9,he))),128))],512)),[[O,m(M)]]):W("",!0),o.periodoSeleccionado==="semana"?N((l(),d("select",{key:1,"onUpdate:modelValue":e[2]||(e[2]=t=>z(A)?A.value=t:A=t),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(l(!0),d(y,null,x(m(te),(t,n)=>(l(),d("option",{key:n,value:t},"Semana "+h(t),9,ye))),128))],512)),[[O,m(A)]]):o.periodoSeleccionado==="mes"?N((l(),d("select",{key:2,"onUpdate:modelValue":e[3]||(e[3]=t=>z(w)?w.value=t:w=t),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(l(),d(y,null,x(P,(t,n)=>a("option",{key:n,value:n+1},h(t),9,_e)),64))],512)),[[O,m(w)]]):o.periodoSeleccionado==="anio"?N((l(),d("select",{key:3,"onUpdate:modelValue":e[4]||(e[4]=t=>z(k)?k.value=t:k=t),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(l(!0),d(y,null,x(m(ie),t=>(l(),d("option",{key:t,value:t},h(t),9,Me))),128))],512)),[[O,m(k)]]):W("",!0)])]),a("div",Ae,[(l(),d(y,null,x(oe,t=>a("button",{key:t.tipo,class:X(t.clase),onClick:n=>H(o,t.tipo,R.directivo,{tipo:o.periodoSeleccionado,valor:o.periodoSeleccionado==="dia"?m(M):o.periodoSeleccionado==="semana"?m(A):o.periodoSeleccionado==="mes"?m(w):o.periodoSeleccionado==="anio"?m(k):""})},[a("i",{class:X(t.icono+" mr-2 jump-icon")},null,2),ne(" "+h(t.texto),1)],10,we)),64))])])),64))}},De={class:"mt-1 bg-white p-4 shadow rounded-lg h-5/6"},Te={__name:"Reportes",props:{message:{String,default:""},color:{String,default:""},usuario:{type:Object},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},tipoUltimaCorrida:{type:Object,default:()=>({})},movimiento:{type:Object,default:()=>({})},directivo:{type:Object,default:()=>({})},tipoMovimiento:{type:Object,default:()=>({})}},setup(C){const c=C;return(R,_)=>(l(),le(ue,{title:"Reportes",usuario:c.usuario},{default:de(()=>[a("div",De,[_[0]||(_[0]=a("h2",{class:"font-bold text-center text-xl pt-0 mb-2"},"Reportes",-1)),_[1]||(_[1]=a("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-2"},null,-1)),ce(ke,{unidad:c.unidad,operador:c.operador,directivo:c.directivo,movimiento:c.movimiento,tipoMovimiento:c.tipoMovimiento},null,8,["unidad","operador","directivo","movimiento","tipoMovimiento"])])]),_:1},8,["usuario"]))}};export{Te as default};
