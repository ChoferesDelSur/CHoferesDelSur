import{C as y,D as m,c as C,a as j,o as R,w as f,b as n,t as x,u as b,d as H}from"./app-B_eqyLv_.js";import"./buttons.print-BJu4EocC.js";import"./jspdf.plugin.autotable-B7gWxSE8.js";import{_ as O}from"./DirectivoLayout-cHDIk3Br.js";const $={class:"mt-0 bg-white p-4 shadow rounded-lg h-5/6"},L={class:"py-2 text-center text-sm font-semibold bg-gray-100 rounded mb-2"},T={class:"overflow-x-auto relative"},k={__name:"FormarUnidades",props:{message:{String,default:""},color:{String,default:""},ruta:{type:Object},unidades:{type:Object},unidadesConOperador:{type:Object},operador:{type:Object},directivo:{type:Object},rolServicio:{type:Object},castigo:{type:Object},entrada:{type:Object},corte:{type:Object},ultimaCorrida:{type:Object},tipoUltimaCorrida:{type:Object},usuario:{type:Object}},setup(h){y.use(m),y.use(m);const d=h,p=`${d.usuario.apellidoP} ${d.usuario.apellidoM} ${d.usuario.nombre}`;function U(o){const i=new Date(o),c=new Date(i.setDate(i.getDate()-i.getDay()+1)),s=new Date(i.getFullYear(),0,1),r=Math.floor((c-s)/(24*60*60*1e3));return Math.ceil((r+s.getDay()+1)/7)}const u=new Date().toLocaleDateString(),w=D(new Date().getDay()),v=U(new Date);function D(o){return["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][o]}const S=[{data:"idUnidad",render:(o,i,c,s)=>{const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;return e&&e.nombre_completo===p?`<span style="font-size: 11px;">${r.ruta?r.ruta.nombreRuta:""}</span>`:""}else return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;if(e&&e.nombre_completo===p){const t=d.rolServicio.filter(a=>a.idUnidad===r.idUnidad);return t.length>0?(t.sort((a,l)=>new Date(l.created_at)-new Date(a.created_at)),t[0].trabajaDomingo):'<span style="color: red;">Sin asignar</span>'}else return""}else return"Unidad no encontrada"}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;return e&&e.nombre_completo===p?r.numeroUnidad:""}else return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;if(e&&e.nombre_completo===p){const t=d.entrada.filter(a=>a.idUnidad===r.idUnidad&&new Date(a.created_at).toLocaleDateString()===u);if(t.length>0)return t.map(l=>l.horaEntrada.substring(0,5)).join(", ")}}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;if(e&&e.nombre_completo===p){const t=d.entrada.filter(a=>a.idUnidad===r.idUnidad&&new Date(a.created_at).toLocaleDateString()===u);if(t.length>0)return t.map(l=>l.tipoEntrada).join(", ")}}return""}},{data:"idUnidad",className:"text-center",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;if(e&&e.nombre_completo===p){const t=d.entrada.filter(a=>a.idUnidad===r.idUnidad&&new Date(a.created_at).toLocaleDateString()===u);if(t.length>0)return t.map(l=>l.extremo).join(", ")}}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((a,l)=>`
            <div style="${e.length>1&&l!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${a.horaCorte.substring(0,5)}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((a,l)=>`
            <div style="${e.length>1&&l!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${a.causa}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((a,l)=>{const g=a.horaRegreso?a.horaRegreso.substring(0,5):"";return`
            <div style="${e.length>1&&l!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${g}</div>
            </div>
          `}).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=d.tipoUltimaCorrida.find(a=>a.idTipoUltimaCorrida===e[0].idTipoUltimaCorrida);if(t)return t.tipoUltimaCorrida}}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=e[0].horaInicioUC;return t?t.substring(0,5):""}}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=e[0].horaFinUC;if(t)return t.substring(0,5)}}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>({horaInicio:t.horaInicio?t.horaInicio.substring(0,5):""}));return e.map((t,a)=>`
          <div style="${e.length>1&&a!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaInicio}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>({horaFin:t.horaFin?t.horaFin.substring(0,5):""}));return e.map((t,a)=>`
          <div style="${e.length>1&&a!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaFin}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>t.castigo||"");return e.map((t,a)=>`<div style="${e.length>1&&a!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>t.observaciones||"");return e.map((t,a)=>`<div style="${e.length>1&&a!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,i,c,s){const r=d.unidades.find(e=>e.idUnidad===o);if(r){const e=r.directivo;if(e&&e.nombre_completo===p){const t=d.operador.find(a=>a.idOperador===r.idOperador);return t?t.nombre_completo:'<span style="color: red;">Sin asignar</span>'}else return""}else return""}}],_=C(()=>d.unidades.filter(i=>i.directivo.nombre_completo===p));return(o,i)=>(R(),j(O,{title:"Formar Unidades",usuario:d.usuario},{default:f(()=>[n("div",$,[i[1]||(i[1]=n("h2",{class:"font-bold text-center text-xl pt-0"}," Formación de Unidades",-1)),i[2]||(i[2]=n("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-1.5"},null,-1)),n("div",L,[n("span",null,"FECHA: "+x(b(w)+", "+b(u))+" -- SEMANA: "+x(b(v)),1)]),n("div",T,[H(b(y),{class:"w-full table-auto text-sm display nowrap stripe compact cell-border order-column",id:"formacionTablaId",name:"formacionTablaId",columns:S,data:_.value,options:{responsive:!1,autoWidth:!1,language:{search:"Buscar",zeroRecords:"No hay registros para mostrar",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)"},paging:!1,lengthMenu:[]}},{default:f(()=>i[0]||(i[0]=[n("thead",null,[n("tr",{class:"text-sm leading-normal border-b border-gray-300"},[n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}),n("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300 text-left",colspan:"3"},"ENTRADA"),n("th",{class:"py-2 px-4 bg-red-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"CORTE"),n("th",{class:"py-2 px-4 bg-blue-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"ÚLTIMAS CORRIDAS"),n("th",{class:"py-2 px-4 bg-yellow-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"4"},"CASTIGO"),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"})]),n("tr",{class:"text-sm leading-normal border-b border-gray-300"},[n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Ruta "),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Dom "),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Unidad "),n("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. ent "),n("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo "),n("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Ext "),n("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Cor "),n("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Causa "),n("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Reg "),n("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo "),n("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Ini "),n("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Reg "),n("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Ini "),n("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Fin "),n("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Motivo "),n("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Observaciones "),n("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Operador ")])],-1)])),_:1},8,["data"])])])]),_:1},8,["usuario"]))}};export{k as default};
