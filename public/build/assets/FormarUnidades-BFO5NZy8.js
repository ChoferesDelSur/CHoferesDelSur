import{L as _,D as H,q as B,o as V,j as P,e as R,a as i,b as G,t as q,d as D,x as J}from"./app-ywvr1C1W.js";import"./buttons.print-BwyIRfx8.js";/* empty css                                                */import"./jspdf.plugin.autotable-B2lAXuPa.js";import{u as v,w as W}from"./xlsx-769MyM77.js";import{_ as X}from"./RHLayout-0dQW0d_M.js";const K={class:"mt-0 bg-white p-4 shadow rounded-lg h-5/6"},Q=i("h2",{class:"font-bold text-center text-xl pt-0"}," Formar Unidades",-1),Y=i("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-1.5"},null,-1),Z={class:"overflow-x-auto"},ee={class:"text-sm leading-normal border-b border-gray-300"},te=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),re={class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"2"},ae=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),de=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),oe=i("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300 text-left",colspan:"3"},"ENTRADA",-1),ie=i("th",{class:"py-2 px-4 bg-red-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"CORTE",-1),ne=i("th",{class:"py-2 px-4 bg-blue-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"ÚLTIMAS CORRIDAS",-1),se=i("th",{class:"py-2 px-4 bg-yellow-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"4"},"CASTIGO",-1),ce=i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),le=i("tr",{class:"text-sm leading-normal border-b border-gray-300"},[i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," ID "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Ruta "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Trab. DOMINGO "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Unidad "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Socio / Prestador "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. entrada "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo entrada "),i("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Extremo "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Corte "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Causa "),i("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo de Corrida "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),i("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. finaliza "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Motivo "),i("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Otras observaciones "),i("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Operador ")],-1),fe={__name:"FormarUnidades",props:{message:{String,default:""},color:{String,default:""},ruta:{type:Object},unidad:{type:Object},unidadesConOperador:{type:Object},operador:{type:Object},directivo:{type:Object},rolServicio:{type:Object},castigo:{type:Object},entrada:{type:Object},corte:{type:Object},ultimaCorrida:{type:Object},tipoUltimaCorrida:{type:Object},usuario:{type:Object}},setup(S){_.use(H),_.use(H);const d=S,b=new Date().toLocaleDateString(),E=T(new Date().getDay());function T(o){return["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][o]}B(()=>d.entrada.filter(o=>new Date(o.fechaRegistro).toLocaleDateString()===b));const I=()=>{J(()=>{const c=$("#formacionTablaId").DataTable().rows({search:"applied",page:"current"}).data();if(!c.length){console.warn("No hay datos para exportar.");return}const l=new Date().toISOString().split("T")[0],p=Object.fromEntries(d.ruta.map(a=>[a.idRuta,a.nombreRuta])),r=Object.fromEntries(d.rolServicio.map(a=>[a.idRolServicio,a.trabajaDomingo])),e=Object.fromEntries(d.unidad.map(a=>[a.idUnidad,a.numeroUnidad])),t=Object.fromEntries(d.directivo.map(a=>[a.idDirectivo,a.nombre_completo])),s=Object.fromEntries(d.entrada.map(a=>[a.idUnidad,{horaEntrada:a.horaEntrada,tipoEntrada:a.tipoEntrada,extremo:a.extremo,created_at:a.created_at}]));Object.fromEntries(d.corte.map(a=>[a.idUnidad,[]]));const g=Object.fromEntries(d.ultimaCorrida.map(a=>[a.idUnidad,{tipoCorrida:a.idTipoUltimaCorrida,horaInicioUC:a.horaInicioUC,horaFinUC:a.horaFinUC,created_at:a.created_at}]));Object.fromEntries(d.castigo.map(a=>[a.idUnidad,[]]));const f=Object.fromEntries(d.operador.map(a=>[a.idOperador,a.nombre_completo])),m=a=>{if(!a)return"";const[n,y]=a.split(":");return`${n}:${y}`},M=c.toArray().reduce((a,n)=>{var w,j;const y=s[n.idUnidad]||{},z=d.corte.filter(u=>u.idUnidad===n.idUnidad&&u.created_at.split("T")[0]===l),h=g[n.idUnidad]||{},O=d.castigo.filter(u=>u.idUnidad===n.idUnidad&&u.created_at.split("T")[0]===l),x=((w=y.created_at)==null?void 0:w.split("T")[0])===l,U=((j=h.created_at)==null?void 0:j.split("T")[0])===l;return O.length>0,a[n.idUnidad]||(a[n.idUnidad]={ID:n.idUnidad,Ruta:p[n.idRuta]||"N/A","Trab. Domingo":r[n.idRolServicio]||"Sin Asignar",Unidad:e[n.idUnidad]||"","Socio/Prestador":t[n.idDirectivo]||"","Hr. Entrada":x&&m(y.horaEntrada)||"","Tipo Entrada":x&&y.tipoEntrada||"",Extremo:x&&y.extremo||"","Hr. Corte":"",Causa:"","Hr. Regreso":"","Tipo De Corrida":U&&h.tipoCorrida||"","Hr. Inicio UC":U&&m(h.horaInicioUC)||"","Hr. Regreso UC":U&&m(h.horaFinUC)||"","Hr. Inicio":"","Hr. Finaliza":"",Motivo:"","Otras Observaciones":"",Operador:f[n.idOperador]||"Sin Asignar"}),z.forEach(u=>{a[n.idUnidad]["Hr. Corte"]+=(a[n.idUnidad]["Hr. Corte"]?", ":"")+m(u.horaCorte),a[n.idUnidad].Causa+=(a[n.idUnidad].Causa?", ":"")+u.causa,a[n.idUnidad]["Hr. Regreso"]+=(a[n.idUnidad]["Hr. Regreso"]?", ":"")+m(u.horaRegreso)}),O.forEach(u=>{a[n.idUnidad]["Hr. Inicio"]+=(a[n.idUnidad]["Hr. Inicio"]?", ":"")+m(u.horaInicio),a[n.idUnidad]["Hr. Finaliza"]+=(a[n.idUnidad]["Hr. Finaliza"]?", ":"")+m(u.horaFin),a[n.idUnidad].Motivo+=(a[n.idUnidad].Motivo?", ":"")+u.castigo,a[n.idUnidad]["Otras Observaciones"]+=(a[n.idUnidad]["Otras Observaciones"]?", ":"")+u.observaciones}),a},{}),k=Object.values(M),A=v.json_to_sheet(k),C=v.book_new();v.book_append_sheet(C,A,"Formación De Unidades");const N=new Date().toISOString().split("T")[0];W(C,`Formación_De_Unidades_${N}.xlsx`)})},F=[{extend:"copyHtml5",text:'<i class="fa-solid fa-copy"></i> Copiar',className:"bg-cyan-500 hover:bg-cyan-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,2]},button:!0},{title:"Formación De Unidades",text:'<i class="fa-solid fa-file-excel"></i> Excel',className:"bg-green-600 hover:bg-green-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",action:()=>I()},{title:"Formación De Unidades",extend:"print",text:'<i class="fa-solid fa-print"></i> Imprimir',className:"bg-blue-500 hover:bg-blue-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}}],L=[{data:null,render:function(o,c,l,p){return p.row+1}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.ruta.find(t=>t.idRuta===r.idRuta);return e?e.nombreRuta:""}else return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.rolServicio.filter(t=>t.idUnidad===r.idUnidad);return e.length>0?(e.sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)),e[0].trabajaDomingo):'<span style="color: red;">Sin asignar</span>'}else return"Unidad no encontrada"}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);return r?r.numeroUnidad:""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.directivo.find(t=>t.idDirectivo===r.idDirectivo);return e?e.nombre_completo:""}else return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map(s=>s.horaEntrada.substring(0,5)).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map(s=>s.tipoEntrada).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map(s=>s.extremo).join(", ")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map((s,g)=>`
            <div style="${e.length>1&&g!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${s.horaCorte.substring(0,5)}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map((s,g)=>`
            <div style="${e.length>1&&g!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${s.causa}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0)return e.map((s,g)=>{const f=s.horaRegreso?s.horaRegreso.substring(0,5):"";return`
            <div style="${e.length>1&&g!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${f}</div>
            </div>
          `}).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0){const t=d.tipoUltimaCorrida.find(s=>s.idTipoUltimaCorrida===e[0].idTipoUltimaCorrida);if(t)return t.tipoUltimaCorrida}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0){const t=e[0].horaInicioUC;return t?t.substring(0,5):""}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===b);if(e.length>0){const t=e[0].horaFinUC;if(t)return t.substring(0,5)}}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===b);if(r.length>0){const e=r.map(t=>({horaInicio:t.horaInicio?t.horaInicio.substring(0,5):""}));return e.map((t,s)=>`
          <div style="${e.length>1&&s!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaInicio}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===b);if(r.length>0){const e=r.map(t=>({horaFin:t.horaFin?t.horaFin.substring(0,5):""}));return e.map((t,s)=>`
          <div style="${e.length>1&&s!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaFin}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===b);if(r.length>0){const e=r.map(t=>t.castigo||"");return e.map((t,s)=>`<div style="${e.length>1&&s!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.castigo.filter(e=>e.idUnidad===o&&new Date(e.created_at).toLocaleDateString()===b);if(r.length>0){const e=r.map(t=>t.observaciones||"");return e.map((t,s)=>`<div style="${e.length>1&&s!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(o,c,l,p){const r=d.unidad.find(e=>e.idUnidad===o);if(r){const e=d.operador.find(t=>t.idOperador===r.idOperador);return e?e.nombre_completo:'<span style="color: red;">Sin asignar</span>'}else return""}}];return(o,c)=>(V(),P(X,{title:"Formar Unidades",usuario:d.usuario},{default:R(()=>[i("div",K,[Q,Y,i("div",Z,[G(D(_),{class:"w-full table-auto text-sm display nowrap stripe compact cell-border order-column",id:"formacionTablaId",name:"formacionTablaId",columns:L,data:S.unidad,options:{responsive:!1,autoWidth:!1,dom:"Bftrip",language:{search:"Buscar",zeroRecords:"No hay registros para mostrar",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)"},buttons:[F],paging:!1,lengthMenu:[]}},{default:R(()=>[i("thead",null,[i("tr",ee,[te,i("th",re,"FECHA: "+q(D(E)+", "+D(b)),1),ae,de,oe,ie,ne,se,ce]),le])]),_:1},8,["data","options"])])])]),_:1},8,["usuario"]))}};export{fe as default};
