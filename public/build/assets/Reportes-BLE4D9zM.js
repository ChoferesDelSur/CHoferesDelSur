import{_ as ma,a as ga,b as fa,c as ba,d as ha,e as xa,f as va,g as Sa}from"./ReportesUltimasCorridas--Ok_noaG.js";import{_ as _a}from"./ServicioLayout-Ds_IdcEC.js";import{_ as Ea}from"./ReporteOperadoresSinTrabajar-MZTrBDw4.js";import{K as oa,r as Q,o as g,h as f,y as E,b as n,t as y,j as L,z as F,u as v,L as j,F as C,n as A,k as ra,I as ta,i as ya,a as Ca,w as $a,d as x}from"./app-lkWNwiXp.js";import{S as U}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{u as N,w as na}from"./xlsx-DjuO7_Ju.js";import{E as ia}from"./jspdf.plugin.autotable-C4bAsim1.js";/* empty css                                                               */const wa={class:"text-lg font-bold"},Ua={class:"flex flex-wrap gap-4 mb-3"},Oa={class:"flex flex-wrap space-x-3 mb-2"},ka=["value"],La={class:"flex flex-wrap space-x-3"},Fa=["onClick"],Na={__name:"ReportesMultasDominicales",props:{message:{String,default:""},color:{String,default:""},unidad:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})}},setup(R){const r=oa({unidad:null,operador:null}),S=Q([]);let m=1;const K=[{titulo:"Multas Dominicales"}],P=[{tipo:"pdf",texto:"Generar PDF",clase:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-pdf"},{tipo:"excel",texto:"Generar Excel",clase:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-excel"}],O=p=>{if(!p)return"Sin registro";const[d,c]=p.split(":");return`${d}:${c}`},B=async p=>{const d=route("reporte.multasDominicales",{semana:p});try{const c=await ta.get(d);S.value=Object.values(c.data)}catch(c){console.error("Error al obtener los datos:",c.response?c.response.data:c.message),U.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},I=async(p,d,c,u)=>{if(!m){U.fire({title:"Error",text:"Por favor seleccione una semana para generar el archivo.",icon:"error",confirmButtonText:"OK"});return}try{await B(m),p.titulo==="Multas Dominicales"&&(d==="pdf"?V(p.titulo,m):d==="excel"&&T(p.titulo,m))}catch{U.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},k=p=>p?`${p.apellidoP} ${p.apellidoM} ${p.nombre}`:"Sin registro",V=p=>{const d=new ia("landscape");d.setFontSize(12),d.text(`Reporte de ${p}`,14,20);const c=S.value.map(t=>{const a=t.numeroUnidad||"N/A",e=t.directivo?`${t.directivo.nombre_completo}`:"N/A",o=t.entradaSabado?O(t.entradaSabado.horaEntrada):"Sin registro",l=t.entradaSabado?k(t.entradaSabado.operador):"Sin registro",b=t.entradaSabado&&t.entradaSabado.ruta?t.entradaSabado.ruta.nombreRuta:"Sin registro",w=t.entradaLunesTemprana?O(t.entradaLunesTemprana.horaEntrada):"Sin registro",h=t.entradaLunesTemprana?k(t.entradaLunesTemprana.operador):"Sin registro",s=t.entradaLunesTemprana&&t.entradaLunesTemprana.ruta?t.entradaLunesTemprana.ruta.nombreRuta:"Sin registro";return[a,e,o,l,b,w,h,s]}),u=[["Numero Unidad","Socio/Prestador","Sábado (horaEntrada)","Operador (Sábado)","Ruta (Sábado)","Lunes (horaEntrada)","Operador (Lunes)","Ruta (Lunes)"]];d.autoTable({head:u,body:c,startY:24}),d.save(`${p}.pdf`)},T=(p,d)=>{const c=`${p}-Semana-${d}.xlsx`,u=[["Numero Unidad","Socio/Prestador","Sábado (horaEntrada)","Operador (Sábado)","Ruta (Sábado)","Lunes (horaEntrada)","Operador (Lunes)","Ruta (Lunes)","Justificado"]];console.log("en generarExcel:",S.value),S.value.forEach(e=>{const o=e.numeroUnidad||"N/A",l=e.directivo?`${e.directivo.nombre_completo}`:"N/A",b=e.entradaSabado?O(e.entradaSabado.horaEntrada):"Sin registro",w=e.entradaSabado?k(e.entradaSabado.operador):"Sin registro",h=e.entradaSabado&&e.entradaSabado.ruta?e.entradaSabado.ruta.nombreRuta:"Sin registro",s=e.entradaLunesTemprana?O(e.entradaLunesTemprana.horaEntrada):"Sin registro",$=e.entradaLunesTemprana?k(e.entradaLunesTemprana.operador):"Sin registro",_=e.entradaLunesTemprana&&e.entradaLunesTemprana.ruta?e.entradaLunesTemprana.ruta.nombreRuta:"Sin registro";u.push([o,l,b,w,h,s,$,_,""])});const t=N.book_new(),a=N.aoa_to_sheet(u);N.book_append_sheet(t,a,"Reporte_Multas"),na(t,c)},D=Array.from({length:52},(p,d)=>d+1);return(p,d)=>(g(),f(C,null,E(K,c=>n("div",{key:c.titulo,class:"mb-4 bg-zinc-100 rounded-lg p-4"},[n("h3",wa,y(c.titulo),1),d[2]||(d[2]=n("div",{class:"bg-gradient-to-r from-cyan-500 to-cyan-500 h-px mb-2"},null,-1)),n("div",Ua,[n("div",Oa,[d[1]||(d[1]=n("h2",{class:"font-semibold text-l pt-0"},"Semana: ",-1)),L(n("select",{"onUpdate:modelValue":d[0]||(d[0]=u=>j(m)?m.value=u:m=u),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2"},[(g(!0),f(C,null,E(v(D),u=>(g(),f("option",{key:u,value:u},"Semana "+y(u),9,ka))),128))],512),[[F,v(m)]])])]),n("div",La,[(g(),f(C,null,E(P,u=>n("button",{key:u.tipo,class:A(u.clase),onClick:t=>I(c,u.tipo,r.unidad,{tipo:c.periodoSeleccionado,valor:c.periodoSeleccionado==="semana"?v(m):""})},[n("i",{class:A(u.icono+" mr-2 jump-icon")},null,2),ra(" "+y(u.texto),1)],10,Fa)),64))])])),64))}},Ta={class:"text-lg font-bold"},Aa={class:"flex flex-wrap gap-4 mb-3"},Ra=["value"],Da={class:"flex flex-wrap gap-4 mb-3"},ja={class:"flex flex-wrap space-x-3 mb-2"},Ka=["onUpdate:modelValue"],Pa=["value"],Ba=["value"],Ia=["value"],Va={class:"flex flex-wrap space-x-3"},za=["onClick"],ea=2024,Ma={__name:"ReportesConcentrado",props:{message:{String,default:""},color:{String,default:""},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},castigo:{type:Object,default:()=>({})},ultimaCorrida:{type:Object,default:()=>({})},tipoUltimaCorrida:{type:Object,default:()=>({})}},setup(R){const r=Q([]),S=Q(!1),m=oa({unidad:null,operador:null}),K=async(t,a)=>{let e="";a.tipo==="semana"?e=route("reportes.concentradoSemana",{idUnidad:t,semana:a.valor}):a.tipo==="mes"||typeof a=="number"?e=route("reportes.concentradoMes",{idUnidad:t,mes:a.valor}):a.tipo==="anio"&&(e=route("reportes.concentradoAnio",{idUnidad:t,anio:a.valor}));try{const o=await ta.get(e);r.value=o.data}catch{U.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},P=async(t,a,e,o)=>{if(!e||!o.tipo||!o.valor){U.fire({title:"Error",text:"Por favor seleccione los parámetros para poder generar el archivo.",icon:"error",confirmButtonText:"OK"});return}let l={tipo:t.periodoSeleccionado,valor:""};t.periodoSeleccionado==="semana"?l.valor=d:t.periodoSeleccionado==="mes"?l.valor=c:t.periodoSeleccionado==="anio"&&(l.valor=u),S.value=!0;try{await K(e,l),t.titulo==="Concentrado"?a==="pdf"?O(t.titulo,l):a==="excel"?B(t.titulo,l):a==="imprimir"&&imprimirReporte(t.titulo,l):U.fire({title:`Generar el reporte "${t.titulo}" en ${a}`,text:"Lógica para generar este tipo de reporte aquí",icon:"info",confirmButtonText:"OK"})}catch(b){console.error(b),U.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}finally{S.value=!1}},O=(t,a)=>{const e=a.tipo==="semana"?`Semana ${a.valor}`:a.tipo==="mes"?T[a.valor-1]:a.valor,o=`${t}-${e}.pdf`,l=new ia("landscape");l.setFontSize(12),l.text(`Reporte de ${t} - Período: ${e}`,14,20);const b=[{header:"Ruta",dataKey:"ruta"},{header:"Fecha",dataKey:"fecha"},{header:"Numero Unidad",dataKey:"numeroUnidad"},{header:"Socio/Prestador",dataKey:"socioPrestador"},{header:"Hora Entrada",dataKey:"horaEntrada"},{header:"Tipo Entrada",dataKey:"tipoEntrada"},{header:"Extremo",dataKey:"extremo"},{header:"Operador",dataKey:"operador"}],w=r.value.map(s=>{var $,_;return{ruta:(($=s.ruta)==null?void 0:$.nombreRuta)||"N/A",fecha:s.created_at?new Date(s.created_at).toLocaleDateString():"N/A",numeroUnidad:((_=s.unidad)==null?void 0:_.numeroUnidad)||"N/A",socioPrestador:s.directivo?`${s.directivo.nombre_completo}`:"N/A",horaEntrada:s.horaEntrada?s.horaEntrada.substring(0,5):"N/A",tipoEntrada:s.tipoEntrada||"Tarde",extremo:s.extremo||"N/A",operador:s.operador?`${s.operador.nombre_completo}`:"N/A"}});l.autoTable({head:[b.map(s=>s.header)],body:w.map(s=>b.map($=>s[$.dataKey])),startY:24,styles:{fontSize:10,cellPadding:4,halign:"center"}});const h=new Date().toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"});l.setFontSize(10),l.text(`Fecha de creación: ${h}`,14,l.internal.pageSize.height-10),l.save(o)},B=(t,a)=>{let e;a.tipo==="semana"?e=`Semana ${a.valor}`:a.tipo==="mes"?e=T[a.valor-1]:(a.tipo,e=a.valor);const o=`${t}-${e}.xlsx`,l=[["Ruta","Fecha","Núm. Unidad","Socio/Prestador","Operador","Hora Entrada","Tipo Entrada","Ext","Hora Corte","Hora Regreso","Causa","Hora Inicio Castigo","Hora Fin Castigo","Castigo","Observaciones","Hora Inicio UC","Hora Fin UC","Tipo UC"]];r.value.forEach(h=>{h.entradas.forEach(s=>{const $=s.ruta.nombreRuta||"N/A",_=s.created_at?new Date(s.created_at).toLocaleDateString():"N/A",sa=h.unidad||"N/A",da=s.directivo.nombre_completo||"N/A",la=s.operador?`${s.operador.nombre_completo}`:"N/A",ca=s.horaEntrada?s.horaEntrada.substring(0,5):"N/A",ua=s.tipoEntrada||"",pa=s.extremo||"N/A";let z="",M="",H="",G="",Y="",J="",q="";h.cortes.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(z+=z?`, ${i.horaCorte?i.horaCorte.substring(0,5):""}`:i.horaCorte?i.horaCorte.substring(0,5):"",M+=M?`, ${i.horaRegreso?i.horaRegreso.substring(0,5):""}`:i.horaRegreso?i.horaRegreso.substring(0,5):"",H+=H?`, ${i.causa||""}`:i.causa||"")}),h.castigos.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(G+=G?`, ${i.horaInicio?i.horaInicio.substring(0,5):""}`:i.horaInicio?i.horaInicio.substring(0,5):"",Y+=Y?`, ${i.horaFin?i.horaFin.substring(0,5):""}`:i.horaFin?i.horaFin.substring(0,5):"",J+=J?`, ${i.castigo||""}`:i.castigo||"",q+=q?`, ${i.observaciones||""}`:i.observaciones||"")});let W="",X="",Z="";h.ultimaCorridas.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(W=i.horaInicioUC?i.horaInicioUC.substring(0,5):"",X=i.horaFinUC?i.horaFinUC.substring(0,5):"",Z=i.tipo_ultima_corrida.tipoUltimaCorrida||"")}),l.push([$,_,sa,da,la,ca,ua,pa,z,M,H,G,Y,J,q,W,X,Z])})});const b=N.book_new(),w=N.aoa_to_sheet(l);N.book_append_sheet(b,w,"Reporte_Concentrado"),na(b,o)},I=[{titulo:"Concentrado",periodo:"semana",periodoSeleccionado:"semana"}],k=[{tipo:"pdf",texto:"Generar PDF",clase:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-pdf"},{tipo:"excel",texto:"Generar Excel",clase:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-excel"}],V=Array.from({length:52},(t,a)=>a+1),T=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],D=new Date().getFullYear(),p=Array.from({length:D-ea+1},(t,a)=>ea+a);let d=1,c=1,u=D;return(t,a)=>(g(),f(C,null,E(I,e=>n("div",{key:e.titulo,class:"mb-4 bg-zinc-100 rounded-lg p-4"},[n("h3",Ta,y(e.titulo),1),a[10]||(a[10]=n("div",{class:"bg-gradient-to-r from-cyan-500 to-cyan-500 h-px mb-2"},null,-1)),n("div",Aa,[a[6]||(a[6]=n("h2",{class:"font-semibold text-l pt-0"},"Buscar por: ",-1)),n("div",null,[n("div",null,[L(n("select",{name:"unidad",id:"unidad","onUpdate:modelValue":a[0]||(a[0]=o=>m.unidad=o),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[a[4]||(a[4]=n("option",{disabled:"",select:"",value:""},"----- Unidad ----- ",-1)),a[5]||(a[5]=n("option",{value:"todas"},"Todas las unidades",-1)),(g(!0),f(C,null,E(R.unidad,o=>(g(),f("option",{key:o.idUnidad,value:o.idUnidad},y(o.numeroUnidad),9,Ra))),128))],512),[[F,m.unidad]])])])]),n("div",Da,[n("div",ja,[a[8]||(a[8]=n("h2",{class:"font-semibold text-l pt-0"},"Periodo: ",-1)),L(n("select",{"onUpdate:modelValue":o=>e.periodoSeleccionado=o,class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},a[7]||(a[7]=[n("option",{value:"semana"},"Semanal",-1),n("option",{value:"mes"},"Mensual",-1),n("option",{value:"anio"},"Anual",-1)]),8,Ka),[[F,e.periodoSeleccionado]]),e.periodoSeleccionado==="semana"?L((g(),f("select",{key:0,"onUpdate:modelValue":a[1]||(a[1]=o=>j(d)?d.value=o:d=o),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(g(!0),f(C,null,E(v(V),(o,l)=>(g(),f("option",{key:l,value:o},"Semana "+y(o),9,Pa))),128))],512)),[[F,v(d)]]):e.periodoSeleccionado==="mes"?L((g(),f("select",{key:1,"onUpdate:modelValue":a[2]||(a[2]=o=>j(c)?c.value=o:c=o),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(g(),f(C,null,E(T,(o,l)=>n("option",{key:l,value:l+1},y(o),9,Ba)),64))],512)),[[F,v(c)]]):e.periodoSeleccionado==="anio"?L((g(),f("select",{key:2,"onUpdate:modelValue":a[3]||(a[3]=o=>j(u)?u.value=o:u=o),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(g(!0),f(C,null,E(v(p),o=>(g(),f("option",{key:o,value:o},y(o),9,Ia))),128))],512)),[[F,v(u)]]):ya("",!0)])]),n("div",Va,[(g(),f(C,null,E(k,o=>n("button",{key:o.tipo,class:A(o.clase),onClick:l=>P(e,o.tipo,m.unidad,{tipo:e.periodoSeleccionado,valor:e.periodoSeleccionado==="semana"?v(d):e.periodoSeleccionado==="mes"?v(c):e.periodoSeleccionado==="anio"?v(u):""})},[n("i",{class:A(o.icono+" mr-2 jump-icon")},null,2),ra(" "+y(o.texto),1)],10,za)),64)),n("div",{class:A(["loading-overlay",{show:S.value}])},a[9]||(a[9]=[n("div",{class:"spinner"},null,-1)]),2)])])),64))}},Ha={class:"mt-1 bg-white p-4 shadow rounded-lg h-5/6"},ae={__name:"Reportes",props:{message:{String,default:""},color:{String,default:""},usuario:{type:Object},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},tipoUltimaCorrida:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},ultimaCorrida:{type:Object,default:()=>({})},castigo:{type:Object,default:()=>({})}},setup(R){const r=R;return(S,m)=>(g(),Ca(_a,{title:"Reportes",usuario:r.usuario},{default:$a(()=>[n("div",Ha,[m[0]||(m[0]=n("h2",{class:"font-bold text-center text-xl pt-0 mb-2"},"Reportes",-1)),m[1]||(m[1]=n("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-2"},null,-1)),x(ma,{unidad:r.unidad,operador:r.operador,entrada:r.entrada},null,8,["unidad","operador","entrada"]),x(ga,{unidad:r.unidad,operador:r.operador,entrada:r.entrada},null,8,["unidad","operador","entrada"]),x(fa,{unidad:r.unidad,operador:r.operador,corte:r.corte},null,8,["unidad","operador","corte"]),x(ba,{unidad:r.unidad,operador:r.operador,corte:r.corte},null,8,["unidad","operador","corte"]),x(ha,{unidad:r.unidad,operador:r.operador,corte:r.corte},null,8,["unidad","operador","corte"]),x(xa,{unidad:r.unidad,operador:r.operador,tipoUltimaCorrida:r.tipoUltimaCorrida,ultimaCorrida:r.ultimaCorrida},null,8,["unidad","operador","tipoUltimaCorrida","ultimaCorrida"]),x(va,{unidad:r.unidad,operador:r.operador,castigo:r.castigo},null,8,["unidad","operador","castigo"]),x(Sa,{unidad:r.unidad,operador:r.operador},null,8,["unidad","operador"]),x(Ea,{unidad:r.unidad,operador:r.operador},null,8,["unidad","operador"]),x(Na,{unidad:r.unidad,entrada:r.entrada,corte:r.corte,operador:r.operador},null,8,["unidad","entrada","corte","operador"]),x(Ma,{unidad:r.unidad,operador:r.operador,entrada:r.entrada,corte:r.corte,castigo:r.castigo,ultimaCorrida:r.ultimaCorrida,tipoUltimaCorrida:r.tipoUltimaCorrida},null,8,["unidad","operador","entrada","corte","castigo","ultimaCorrida","tipoUltimaCorrida"])])]),_:1},8,["usuario"]))}};export{ae as default};
