import{L as U,D as O,q as Y,o as K,j as Q,e as H,a as d,b as Z,t as ee,d as _,x as te}from"./app-2HR5oQ8c.js";import"./buttons.print-y0zNFMct.js";/* empty css                                                */import"./jspdf.plugin.autotable-B403eXP8.js";import{u as D,w as re}from"./xlsx-769MyM77.js";import{_ as oe}from"./RHLayout-D-Ubx9ks.js";const ae={class:"mt-0 bg-white p-4 shadow rounded-lg h-5/6"},de=d("h2",{class:"font-bold text-center text-xl pt-0"}," Formar Unidades",-1),ne=d("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-1.5"},null,-1),ie={class:"overflow-x-auto"},se={class:"text-sm leading-normal border-b border-gray-300"},ce=d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),le={class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"2"},pe=d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),ue=d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),be=d("th",{class:"py-2 px-4 bg-green-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300 text-left",colspan:"3"},"ENTRADA",-1),ye=d("th",{class:"py-2 px-4 bg-red-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"CORTE",-1),ge=d("th",{class:"py-2 px-4 bg-blue-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"3"},"ÚLTIMAS CORRIDAS",-1),fe=d("th",{class:"py-2 px-4 bg-yellow-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300",colspan:"4"},"CASTIGO",-1),me=d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"},null,-1),he=d("tr",{class:"text-sm leading-normal border-b border-gray-300"},[d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," ID "),d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Ruta "),d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Trab. DOMINGO "),d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Unidad "),d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Socio / Prestador "),d("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. entrada "),d("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo entrada "),d("th",{class:"py-2 px-4 bg-green-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Extremo "),d("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. Corte "),d("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Causa "),d("th",{class:"py-2 px-4 bg-red-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),d("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Tipo de Corrida "),d("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),d("th",{class:"py-2 px-4 bg-blue-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. regreso "),d("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. inicio "),d("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Hr. finaliza "),d("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Motivo "),d("th",{class:"py-2 px-4 bg-yellow-100 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Otras observaciones "),d("th",{class:"py-2 px-4 bg-sky-200 font-bold uppercase text-sm text-grey-600 border-r border-grey-300"}," Operador ")],-1),ve={__name:"FormarUnidades",props:{message:{String,default:""},color:{String,default:""},ruta:{type:Object},unidad:{type:Object},unidadesConOperador:{type:Object},operador:{type:Object},directivo:{type:Object},rolServicio:{type:Object},castigo:{type:Object},entrada:{type:Object},corte:{type:Object},ultimaCorrida:{type:Object},tipoUltimaCorrida:{type:Object},usuario:{type:Object}},setup(w){U.use(O),U.use(O);const o=w,u=new Date().toLocaleDateString(),T=F(new Date().getDay());function F(a){return["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][a]}Y(()=>o.entrada.filter(a=>new Date(a.fechaRegistro).toLocaleDateString()===u));const I=()=>{te(()=>{const s=$("#formacionTablaId").DataTable().rows({search:"applied"}).data(),n=new Date().toLocaleDateString("es-ES"),c=()=>{const l=new Date,b=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),y=String(l.getDate()).padStart(2,"0");return`${b}-${x}-${y}`},r=l=>{if(!l)return"";const[b,x]=l.split(":");return`${b}:${x}`},e=s.toArray().map(l=>{var S,v,R,C,j;const b=o.ultimaCorrida.find(p=>p.idUnidad===l.idUnidad),x=o.tipoUltimaCorrida.find(p=>p.idTipoUltimaCorrida===(b==null?void 0:b.idTipoUltimaCorrida)),y=o.entrada.find(p=>p.idUnidad===l.idUnidad),h=o.corte.find(p=>p.idUnidad===l.idUnidad),f=o.castigo.find(p=>p.idUnidad===l.idUnidad),g=new Date(y==null?void 0:y.fechaRegistro).toLocaleDateString("es-ES"),k=g===n?r(y==null?void 0:y.horaEntrada):"",A=g===n?y==null?void 0:y.tipoEntrada:"",M=g===n?y==null?void 0:y.extremo:"",N=g===n?r(h==null?void 0:h.horaCorte):"",z=g===n?h==null?void 0:h.causa:"",B=g===n?r(h==null?void 0:h.horaRegreso):"",P=g===n?x==null?void 0:x.tipoUltimaCorrida:"",V=g===n?r(b==null?void 0:b.horaInicioUC):"",G=g===n?r(b==null?void 0:b.horaFinUC):"",q=g===n?r(f==null?void 0:f.horaInicio):"",J=g===n?r(f==null?void 0:f.horaFin):"",W=g===n?f==null?void 0:f.castigo:"",X=g===n?f==null?void 0:f.observaciones:"";return{ID:l.idUnidad,Ruta:(S=o.ruta.find(p=>p.idRuta===l.idRuta))==null?void 0:S.nombreRuta,"Trab. Domingo":(v=o.rolServicio.find(p=>p.idRolServicio===l.idUnidad))==null?void 0:v.trabajaDomingo,Unidad:(R=o.unidad.find(p=>p.idUnidad===l.idUnidad))==null?void 0:R.numeroUnidad,"Socio/Prestador":((C=o.directivo.find(p=>p.idDirectivo===l.idDirectivo))==null?void 0:C.nombre_completo)||"","Hr. Entrada":k,"Tipo Entrada":A,Extremo:M,"Hr. Corte":N,Causa:z,"Hr. Regreso":B,"Tipo De Corrida":P,"Hr. Inicio UC":V,"Hr. Regreso UC":G,"Hr. Inicio":q,"Hr. Finaliza":J,Motivo:W,"Otras Observaciones":X,Operador:(j=o.operador.find(p=>p.idOperador===l.idOperador))==null?void 0:j.nombre_completo}}),t=D.json_to_sheet(e),i=D.book_new();D.book_append_sheet(i,t,"Formación De Unidades");const m=c();re(i,`Formación_De_Unidades_${m}.xlsx`)})},L=[{extend:"copyHtml5",text:'<i class="fa-solid fa-copy"></i> Copiar',className:"bg-cyan-500 hover:bg-cyan-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,2]},button:!0},{title:"Formación De Unidades",text:'<i class="fa-solid fa-file-excel"></i> Excel',className:"bg-green-600 hover:bg-green-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",action:()=>I()},{title:"Formación De Unidades",extend:"print",text:'<i class="fa-solid fa-print"></i> Imprimir',className:"bg-blue-500 hover:bg-blue-600 text-white py-1/2 px-3 rounded mb-2 jump-icon",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}}],E=[{data:null,render:function(a,s,n,c){return c.row+1}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.ruta.find(t=>t.idRuta===r.idRuta);return e?e.nombreRuta:""}else return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.rolServicio.filter(t=>t.idUnidad===r.idUnidad);return e.length>0?(e.sort((t,i)=>new Date(i.created_at)-new Date(t.created_at)),e[0].trabajaDomingo):'<span style="color: red;">Sin asignar</span>'}else return"Unidad no encontrada"}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);return r?r.numeroUnidad:""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.directivo.find(t=>t.idDirectivo===r.idDirectivo);return e?e.nombre_completo:""}else return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map(i=>i.horaEntrada.substring(0,5)).join(", ")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map(i=>i.tipoEntrada).join(", ")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.entrada.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map(i=>i.extremo).join(", ")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((i,m)=>`
            <div style="${e.length>1&&m!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${i.horaCorte.substring(0,5)}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((i,m)=>`
            <div style="${e.length>1&&m!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${i.causa}</div>
            </div>
          `).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.corte.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0)return e.map((i,m)=>{const l=i.horaRegreso?i.horaRegreso.substring(0,5):"";return`
            <div style="${e.length>1&&m!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
              <div>${l}</div>
            </div>
          `}).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=o.tipoUltimaCorrida.find(i=>i.idTipoUltimaCorrida===e[0].idTipoUltimaCorrida);if(t)return t.tipoUltimaCorrida}}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=e[0].horaInicioUC;return t?t.substring(0,5):""}}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.ultimaCorrida.filter(t=>t.idUnidad===r.idUnidad&&new Date(t.created_at).toLocaleDateString()===u);if(e.length>0){const t=e[0].horaFinUC;if(t)return t.substring(0,5)}}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.castigo.filter(e=>e.idUnidad===a&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>({horaInicio:t.horaInicio?t.horaInicio.substring(0,5):""}));return e.map((t,i)=>`
          <div style="${e.length>1&&i!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaInicio}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.castigo.filter(e=>e.idUnidad===a&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>({horaFin:t.horaFin?t.horaFin.substring(0,5):""}));return e.map((t,i)=>`
          <div style="${e.length>1&&i!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">
            <div>${t.horaFin}</div>
          </div>
        `).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.castigo.filter(e=>e.idUnidad===a&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>t.castigo||"");return e.map((t,i)=>`<div style="${e.length>1&&i!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.castigo.filter(e=>e.idUnidad===a&&new Date(e.created_at).toLocaleDateString()===u);if(r.length>0){const e=r.map(t=>t.observaciones||"");return e.map((t,i)=>`<div style="${e.length>1&&i!==e.length-1?"border-bottom: 1px solid #b2b2b2;":""}">${t}</div>`).join("")}return""}},{data:"idUnidad",render:function(a,s,n,c){const r=o.unidad.find(e=>e.idUnidad===a);if(r){const e=o.operador.find(t=>t.idOperador===r.idOperador);return e?e.nombre_completo:'<span style="color: red;">Sin asignar</span>'}else return""}}];return(a,s)=>(K(),Q(oe,{title:"Formar Unidades",usuario:o.usuario},{default:H(()=>[d("div",ae,[de,ne,d("div",ie,[Z(_(U),{class:"w-full table-auto text-sm display nowrap stripe compact cell-border order-column",id:"formacionTablaId",name:"formacionTablaId",columns:E,data:w.unidad,options:{responsive:!1,autoWidth:!1,dom:"Bftrip",language:{search:"Buscar",zeroRecords:"No hay registros para mostrar",info:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)"},buttons:[L],paging:!1,lengthMenu:[]}},{default:H(()=>[d("thead",null,[d("tr",se,[ce,d("th",le,"FECHA: "+ee(_(T)+", "+_(u)),1),pe,ue,be,ye,ge,fe,me]),he])]),_:1},8,["data","options"])])])]),_:1},8,["usuario"]))}};export{ve as default};
