import{_ as pa,a as ma,b as ga,c as fa,d as ba,e as ha,f as xa,g as va}from"./ReportesUltimasCorridas-BMGs6JSy.js";import{_ as Sa}from"./ServicioLayout-a3n9toTk.js";import{_ as _a}from"./ReporteOperadoresSinTrabajar-B_8TW_sh.js";import{K as ea,r as oa,o as p,h as g,y as E,b as t,t as C,j as k,z as L,u as x,L as R,F as $,n as D,k as ra,I as ta,i as Ea,a as Ca,w as $a,d as h}from"./app-Dtd6jTII.js";import{S as w}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{u as F,w as na}from"./xlsx-DjuO7_Ju.js";import{E as ia}from"./jspdf.plugin.autotable-BomS6U7s.js";/* empty css                                                               */const ya={class:"text-lg font-bold"},wa={class:"flex flex-wrap gap-4 mb-3"},Ua={class:"flex flex-wrap space-x-3 mb-2"},Oa=["value"],ka={class:"flex flex-wrap space-x-3"},La=["onClick"],Fa={__name:"ReportesMultasDominicales",props:{message:{String,default:""},color:{String,default:""},unidad:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})}},setup(T){const o=ea({unidad:null,operador:null}),S=oa([]);let m=1;const j=[{titulo:"Multas Dominicales"}],K=[{tipo:"pdf",texto:"Generar PDF",clase:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-pdf"},{tipo:"excel",texto:"Generar Excel",clase:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-excel"}],U=c=>{if(!c)return"Sin registro";const[s,u]=c.split(":");return`${s}:${u}`},P=async c=>{const s=route("reporte.multasDominicales",{semana:c});try{const u=await ta.get(s);S.value=Object.values(u.data)}catch(u){console.error("Error al obtener los datos:",u.response?u.response.data:u.message),w.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},B=async(c,s,u,r)=>{if(!m){w.fire({title:"Error",text:"Por favor seleccione una semana para generar el archivo.",icon:"error",confirmButtonText:"OK"});return}try{await P(m),c.titulo==="Multas Dominicales"&&(s==="pdf"?N(c.titulo,m):s==="excel"&&A(c.titulo,m))}catch{w.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},O=c=>c?`${c.apellidoP} ${c.apellidoM} ${c.nombre}`:"Sin registro",N=c=>{const s=new ia("landscape");s.setFontSize(12),s.text(`Reporte de ${c}`,14,20);const u=S.value.map(a=>{const n=a.numeroUnidad||"N/A",e=a.directivo?`${a.directivo.nombre_completo}`:"N/A",l=a.entradaSabado?U(a.entradaSabado.horaEntrada):"Sin registro",f=a.entradaSabado?O(a.entradaSabado.operador):"Sin registro",y=a.entradaSabado&&a.entradaSabado.ruta?a.entradaSabado.ruta.nombreRuta:"Sin registro",b=a.entradaLunesTemprana?U(a.entradaLunesTemprana.horaEntrada):"Sin registro",d=a.entradaLunesTemprana?O(a.entradaLunesTemprana.operador):"Sin registro",v=a.entradaLunesTemprana&&a.entradaLunesTemprana.ruta?a.entradaLunesTemprana.ruta.nombreRuta:"Sin registro";return[n,e,l,f,y,b,d,v]}),r=[["Numero Unidad","Socio/Prestador","Sábado (horaEntrada)","Operador (Sábado)","Ruta (Sábado)","Lunes (horaEntrada)","Operador (Lunes)","Ruta (Lunes)"]];s.autoTable({head:r,body:u,startY:24}),s.save(`${c}.pdf`)},A=(c,s)=>{const u=`${c}-Semana-${s}.xlsx`,r=[["Numero Unidad","Socio/Prestador","Sábado (horaEntrada)","Operador (Sábado)","Ruta (Sábado)","Lunes (horaEntrada)","Operador (Lunes)","Ruta (Lunes)","Justificado"]];console.log("en generarExcel:",S.value),S.value.forEach(e=>{const l=e.numeroUnidad||"N/A",f=e.directivo?`${e.directivo.nombre_completo}`:"N/A",y=e.entradaSabado?U(e.entradaSabado.horaEntrada):"Sin registro",b=e.entradaSabado?O(e.entradaSabado.operador):"Sin registro",d=e.entradaSabado&&e.entradaSabado.ruta?e.entradaSabado.ruta.nombreRuta:"Sin registro",v=e.entradaLunesTemprana?U(e.entradaLunesTemprana.horaEntrada):"Sin registro",_=e.entradaLunesTemprana?O(e.entradaLunesTemprana.operador):"Sin registro",V=e.entradaLunesTemprana&&e.entradaLunesTemprana.ruta?e.entradaLunesTemprana.ruta.nombreRuta:"Sin registro";r.push([l,f,y,b,d,v,_,V,""])});const a=F.book_new(),n=F.aoa_to_sheet(r);F.book_append_sheet(a,n,"Reporte_Multas"),na(a,u)},I=Array.from({length:52},(c,s)=>s+1);return(c,s)=>(p(),g($,null,E(j,u=>t("div",{key:u.titulo,class:"mb-4 bg-zinc-100 rounded-lg p-4"},[t("h3",ya,C(u.titulo),1),s[2]||(s[2]=t("div",{class:"bg-gradient-to-r from-cyan-500 to-cyan-500 h-px mb-2"},null,-1)),t("div",wa,[t("div",Ua,[s[1]||(s[1]=t("h2",{class:"font-semibold text-l pt-0"},"Semana: ",-1)),k(t("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>R(m)?m.value=r:m=r),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2"},[(p(!0),g($,null,E(x(I),r=>(p(),g("option",{key:r,value:r},"Semana "+C(r),9,Oa))),128))],512),[[L,x(m)]])])]),t("div",ka,[(p(),g($,null,E(K,r=>t("button",{key:r.tipo,class:D(r.clase),onClick:a=>B(u,r.tipo,o.unidad,{tipo:u.periodoSeleccionado,valor:u.periodoSeleccionado==="semana"?x(m):""})},[t("i",{class:D(r.icono+" mr-2 jump-icon")},null,2),ra(" "+C(r.texto),1)],10,La)),64))])])),64))}},Na={class:"text-lg font-bold"},Ta={class:"flex flex-wrap gap-4 mb-3"},Aa=["value"],Ra={class:"flex flex-wrap gap-4 mb-3"},Da={class:"flex flex-wrap space-x-3 mb-2"},ja=["onUpdate:modelValue"],Ka=["value"],Pa=["value"],Ba=["value"],Ia={class:"flex flex-wrap space-x-3"},Va=["onClick"],aa=2024,za={__name:"ReportesConcentrado",props:{message:{String,default:""},color:{String,default:""},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},castigo:{type:Object,default:()=>({})},ultimaCorrida:{type:Object,default:()=>({})},tipoUltimaCorrida:{type:Object,default:()=>({})}},setup(T){const o=oa([]),S=ea({unidad:null,operador:null}),m=async(r,a)=>{let n="";a.tipo==="semana"?n=route("reportes.concentradoSemana",{idUnidad:r,semana:a.valor}):a.tipo==="mes"||typeof a=="number"?n=route("reportes.concentradoMes",{idUnidad:r,mes:a.valor}):a.tipo==="anio"&&(n=route("reportes.concentradoAnio",{idUnidad:r,anio:a.valor}));try{const e=await ta.get(n);o.value=e.data}catch{w.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},j=async(r,a,n,e)=>{if(!n||!e.tipo||!e.valor){w.fire({title:"Error",text:"Por favor seleccione los parámetros para poder generar el archivo.",icon:"error",confirmButtonText:"OK"});return}let l={tipo:r.periodoSeleccionado,valor:""};r.periodoSeleccionado==="semana"?l.valor=c:r.periodoSeleccionado==="mes"?l.valor=s:r.periodoSeleccionado==="anio"&&(l.valor=u);try{await m(n,l),r.titulo==="Concentrado"?a==="pdf"?K(r.titulo,l):a==="excel"?U(r.titulo,l):a==="imprimir"&&imprimirReporte(r.titulo,l):w.fire({title:`Generar el reporte "${r.titulo}" en ${a}`,text:"Lógica para generar este tipo de reporte aquí",icon:"info",confirmButtonText:"OK"})}catch(f){console.error(f),w.fire({title:"Error",text:"No se pudieron obtener los datos",icon:"error",confirmButtonText:"OK"})}},K=(r,a)=>{const n=a.tipo==="semana"?`Semana ${a.valor}`:a.tipo==="mes"?N[a.valor-1]:a.valor,e=`${r}-${n}.pdf`,l=new ia("landscape");l.setFontSize(12),l.text(`Reporte de ${r} - Período: ${n}`,14,20);const f=[{header:"Ruta",dataKey:"ruta"},{header:"Fecha",dataKey:"fecha"},{header:"Numero Unidad",dataKey:"numeroUnidad"},{header:"Socio/Prestador",dataKey:"socioPrestador"},{header:"Hora Entrada",dataKey:"horaEntrada"},{header:"Tipo Entrada",dataKey:"tipoEntrada"},{header:"Extremo",dataKey:"extremo"},{header:"Operador",dataKey:"operador"}],y=o.value.map(d=>{var v,_;return{ruta:((v=d.ruta)==null?void 0:v.nombreRuta)||"N/A",fecha:d.created_at?new Date(d.created_at).toLocaleDateString():"N/A",numeroUnidad:((_=d.unidad)==null?void 0:_.numeroUnidad)||"N/A",socioPrestador:d.directivo?`${d.directivo.nombre_completo}`:"N/A",horaEntrada:d.horaEntrada?d.horaEntrada.substring(0,5):"N/A",tipoEntrada:d.tipoEntrada||"Tarde",extremo:d.extremo||"N/A",operador:d.operador?`${d.operador.nombre_completo}`:"N/A"}});l.autoTable({head:[f.map(d=>d.header)],body:y.map(d=>f.map(v=>d[v.dataKey])),startY:24,styles:{fontSize:10,cellPadding:4,halign:"center"}});const b=new Date().toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"});l.setFontSize(10),l.text(`Fecha de creación: ${b}`,14,l.internal.pageSize.height-10),l.save(e)},U=(r,a)=>{let n;a.tipo==="semana"?n=`Semana ${a.valor}`:a.tipo==="mes"?n=N[a.valor-1]:(a.tipo,n=a.valor);const e=`${r}-${n}.xlsx`,l=[["Ruta","Fecha","Núm. Unidad","Socio/Prestador","Operador","Hora Entrada","Tipo Entrada","Ext","Hora Corte","Hora Regreso","Causa","Hora Inicio Castigo","Hora Fin Castigo","Castigo","Observaciones","Hora Inicio UC","Hora Fin UC","Tipo UC"]];o.value.forEach(b=>{b.entradas.forEach(d=>{const v=d.ruta.nombreRuta||"N/A",_=d.created_at?new Date(d.created_at).toLocaleDateString():"N/A",V=b.unidad||"N/A",da=d.directivo.nombre_completo||"N/A",sa=d.operador?`${d.operador.nombre_completo}`:"N/A",la=d.horaEntrada?d.horaEntrada.substring(0,5):"N/A",ca=d.tipoEntrada||"",ua=d.extremo||"N/A";let z="",M="",H="",G="",Y="",J="",q="";b.cortes.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(z+=z?`, ${i.horaCorte?i.horaCorte.substring(0,5):""}`:i.horaCorte?i.horaCorte.substring(0,5):"",M+=M?`, ${i.horaRegreso?i.horaRegreso.substring(0,5):""}`:i.horaRegreso?i.horaRegreso.substring(0,5):"",H+=H?`, ${i.causa||""}`:i.causa||"")}),b.castigos.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(G+=G?`, ${i.horaInicio?i.horaInicio.substring(0,5):""}`:i.horaInicio?i.horaInicio.substring(0,5):"",Y+=Y?`, ${i.horaFin?i.horaFin.substring(0,5):""}`:i.horaFin?i.horaFin.substring(0,5):"",J+=J?`, ${i.castigo||""}`:i.castigo||"",q+=q?`, ${i.observaciones||""}`:i.observaciones||"")});let Q="",W="",X="";b.ultimaCorridas.forEach(i=>{new Date(i.created_at).toLocaleDateString()===_&&(Q=i.horaInicioUC?i.horaInicioUC.substring(0,5):"",W=i.horaFinUC?i.horaFinUC.substring(0,5):"",X=i.tipo_ultima_corrida.tipoUltimaCorrida||"")}),l.push([v,_,V,da,sa,la,ca,ua,z,M,H,G,Y,J,q,Q,W,X])})});const f=F.book_new(),y=F.aoa_to_sheet(l);F.book_append_sheet(f,y,"Reporte_Concentrado"),na(f,e)},P=[{titulo:"Concentrado",periodo:"semana",periodoSeleccionado:"semana"}],B=[{tipo:"pdf",texto:"Generar PDF",clase:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-pdf"},{tipo:"excel",texto:"Generar Excel",clase:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded",icono:"fa-solid fa-file-excel"}],O=Array.from({length:52},(r,a)=>a+1),N=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],A=new Date().getFullYear(),I=Array.from({length:A-aa+1},(r,a)=>aa+a);let c=1,s=1,u=A;return(r,a)=>(p(),g($,null,E(P,n=>t("div",{key:n.titulo,class:"mb-4 bg-zinc-100 rounded-lg p-4"},[t("h3",Na,C(n.titulo),1),a[9]||(a[9]=t("div",{class:"bg-gradient-to-r from-cyan-500 to-cyan-500 h-px mb-2"},null,-1)),t("div",Ta,[a[6]||(a[6]=t("h2",{class:"font-semibold text-l pt-0"},"Buscar por: ",-1)),t("div",null,[t("div",null,[k(t("select",{name:"unidad",id:"unidad","onUpdate:modelValue":a[0]||(a[0]=e=>S.unidad=e),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[a[4]||(a[4]=t("option",{disabled:"",select:"",value:""},"----- Unidad ----- ",-1)),a[5]||(a[5]=t("option",{value:"todas"},"Todas las unidades",-1)),(p(!0),g($,null,E(T.unidad,e=>(p(),g("option",{key:e.idUnidad,value:e.idUnidad},C(e.numeroUnidad),9,Aa))),128))],512),[[L,S.unidad]])])])]),t("div",Ra,[t("div",Da,[a[8]||(a[8]=t("h2",{class:"font-semibold text-l pt-0"},"Periodo: ",-1)),k(t("select",{"onUpdate:modelValue":e=>n.periodoSeleccionado=e,class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},a[7]||(a[7]=[t("option",{value:"semana"},"Semanal",-1),t("option",{value:"mes"},"Mensual",-1),t("option",{value:"anio"},"Anual",-1)]),8,ja),[[L,n.periodoSeleccionado]]),n.periodoSeleccionado==="semana"?k((p(),g("select",{key:0,"onUpdate:modelValue":a[1]||(a[1]=e=>R(c)?c.value=e:c=e),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(p(!0),g($,null,E(x(O),(e,l)=>(p(),g("option",{key:l,value:e},"Semana "+C(e),9,Ka))),128))],512)),[[L,x(c)]]):n.periodoSeleccionado==="mes"?k((p(),g("select",{key:1,"onUpdate:modelValue":a[2]||(a[2]=e=>R(s)?s.value=e:s=e),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(p(),g($,null,E(N,(e,l)=>t("option",{key:l,value:l+1},C(e),9,Pa)),64))],512)),[[L,x(s)]]):n.periodoSeleccionado==="anio"?k((p(),g("select",{key:2,"onUpdate:modelValue":a[3]||(a[3]=e=>R(u)?u.value=e:u=e),class:"block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[(p(!0),g($,null,E(x(I),e=>(p(),g("option",{key:e,value:e},C(e),9,Ba))),128))],512)),[[L,x(u)]]):Ea("",!0)])]),t("div",Ia,[(p(),g($,null,E(B,e=>t("button",{key:e.tipo,class:D(e.clase),onClick:l=>j(n,e.tipo,S.unidad,{tipo:n.periodoSeleccionado,valor:n.periodoSeleccionado==="semana"?x(c):n.periodoSeleccionado==="mes"?x(s):n.periodoSeleccionado==="anio"?x(u):""})},[t("i",{class:D(e.icono+" mr-2 jump-icon")},null,2),ra(" "+C(e.texto),1)],10,Va)),64))])])),64))}},Ma={class:"mt-1 bg-white p-4 shadow rounded-lg h-5/6"},Za={__name:"Reportes",props:{message:{String,default:""},color:{String,default:""},usuario:{type:Object},unidad:{type:Object,default:()=>({})},operador:{type:Object,default:()=>({})},tipoUltimaCorrida:{type:Object,default:()=>({})},entrada:{type:Object,default:()=>({})},corte:{type:Object,default:()=>({})},ultimaCorrida:{type:Object,default:()=>({})},castigo:{type:Object,default:()=>({})}},setup(T){const o=T;return(S,m)=>(p(),Ca(Sa,{title:"Reportes",usuario:o.usuario},{default:$a(()=>[t("div",Ma,[m[0]||(m[0]=t("h2",{class:"font-bold text-center text-xl pt-0 mb-2"},"Reportes",-1)),m[1]||(m[1]=t("div",{class:"bg-gradient-to-r from-cyan-300 to-cyan-500 h-px mb-2"},null,-1)),h(pa,{unidad:o.unidad,operador:o.operador,entrada:o.entrada},null,8,["unidad","operador","entrada"]),h(ma,{unidad:o.unidad,operador:o.operador,entrada:o.entrada},null,8,["unidad","operador","entrada"]),h(ga,{unidad:o.unidad,operador:o.operador,corte:o.corte},null,8,["unidad","operador","corte"]),h(fa,{unidad:o.unidad,operador:o.operador,corte:o.corte},null,8,["unidad","operador","corte"]),h(ba,{unidad:o.unidad,operador:o.operador,corte:o.corte},null,8,["unidad","operador","corte"]),h(ha,{unidad:o.unidad,operador:o.operador,tipoUltimaCorrida:o.tipoUltimaCorrida,ultimaCorrida:o.ultimaCorrida},null,8,["unidad","operador","tipoUltimaCorrida","ultimaCorrida"]),h(xa,{unidad:o.unidad,operador:o.operador,castigo:o.castigo},null,8,["unidad","operador","castigo"]),h(va,{unidad:o.unidad,operador:o.operador},null,8,["unidad","operador"]),h(_a,{unidad:o.unidad,operador:o.operador},null,8,["unidad","operador"]),h(Fa,{unidad:o.unidad,entrada:o.entrada,corte:o.corte,operador:o.operador},null,8,["unidad","entrada","corte","operador"]),h(za,{unidad:o.unidad,operador:o.operador,entrada:o.entrada,corte:o.corte,castigo:o.castigo,ultimaCorrida:o.ultimaCorrida,tipoUltimaCorrida:o.tipoUltimaCorrida},null,8,["unidad","operador","entrada","corte","castigo","ultimaCorrida","tipoUltimaCorrida"])])]),_:1},8,["usuario"]))}};export{Za as default};
